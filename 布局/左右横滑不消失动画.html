<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ç°ä»£åŒ–æ»‘åŠ¨æ¨ªæ¡Tabç»„ä»¶</title>
    <style>
      /* è®¾ç½® HTML å’Œ body é«˜åº¦ä¸º 100%ï¼Œç¡®ä¿é¡µé¢å……æ»¡å±å¹• */
      html {
        height: 100%;
      }
      
      body {
        height: 100%;
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        margin: 0;
        padding: 20px;
        line-height: 1.6;
      }

      /* ä¸»å®¹å™¨ */
      .main-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 20px;
      }

      /* æ ‡é¢˜ */
      .title {
        text-align: center;
        font-size: 2.5rem;
        color: white;
        margin-bottom: 30px;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
        font-weight: 300;
      }

      /* æ§åˆ¶é¢æ¿ */
      .controls {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

      .btn {
        padding: 10px 20px;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.3s ease;
        background: rgba(255, 255, 255, 0.2);
        color: white;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.3);
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        background: rgba(255, 255, 255, 0.3);
      }

      .btn.active {
        background: rgba(255, 255, 255, 0.9);
        color: #333;
      }

      /* ç»Ÿè®¡ä¿¡æ¯ */
      .stats {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(20px);
        padding: 20px;
        border-radius: 15px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        margin-bottom: 30px;
        display: flex;
        justify-content: space-around;
        text-align: center;
        flex-wrap: wrap;
        gap: 20px;
        border: 1px solid rgba(255, 255, 255, 0.2);
      }

      .stat-item {
        flex: 1;
        min-width: 120px;
      }

      .stat-number {
        font-size: 1.8rem;
        font-weight: bold;
        color: #fff;
        display: block;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      }

      .stat-label {
        color: rgba(255, 255, 255, 0.8);
        font-size: 0.9rem;
        margin-top: 5px;
      }

      /* è®©ä¸»ä½“å†…å®¹å±…ä¸­å¯¹é½ */
      .body-box {
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 30px;
      }

      /* æ ‡ç­¾å®¹å™¨ï¼Œå…è®¸æ¨ªå‘æ»šåŠ¨ï¼Œéšè—æ»šåŠ¨æ¡ */
      .tabs-container {
        width: 100%;
        max-width: 800px;
        overflow-x: auto;
        white-space: nowrap;
        border-radius: 50px;
        background: rgba(33, 35, 38, 0.9);
        backdrop-filter: blur(20px);
        padding: 6px;
        display: flex;
        align-items: flex-start;
        scrollbar-width: none; /* Firefox éšè—æ»šåŠ¨æ¡ */
        -ms-overflow-style: none; /* IE/Edge éšè—æ»šåŠ¨æ¡ */
        position: relative; /* ä¸ºæ»‘åŠ¨æ¨ªæ¡å®šä½ */
        box-shadow: 
          0 8px 32px rgba(0, 0, 0, 0.3),
          inset 0 1px 0 rgba(255, 255, 255, 0.1);
        border: 1px solid rgba(255, 255, 255, 0.1);
      }

      /* Webkit æµè§ˆå™¨ï¼ˆå¦‚ Chrome, Safariï¼‰éšè—æ»šåŠ¨æ¡ */
      .tabs-container::-webkit-scrollbar {
        display: none;
      }

      /* æ»‘åŠ¨æ¨ªæ¡èƒŒæ™¯æŒ‡ç¤ºå™¨ - å¢å¼ºç‰ˆ */
      .sliding-indicator {
        position: absolute;
        top: 6px;
        left: 6px;
        height: calc(100% - 12px);
        background: linear-gradient(135deg, #00d4ff 0%, #009afe 100%);
        border-radius: 50px;
        transition: all 0.4s cubic-bezier(0.4, 0.0, 0.2, 1);
        z-index: 1;
        opacity: 1;
        box-shadow: 
          0 4px 15px rgba(0, 148, 254, 0.4),
          0 2px 8px rgba(0, 148, 254, 0.2);
        transform: translateX(0px);
        will-change: transform, width;
      }

      /* æ»‘åŠ¨æ¨ªæ¡å‘å…‰æ•ˆæœ */
      .sliding-indicator::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(135deg, #00d4ff, #009afe);
        border-radius: 50px;
        z-index: -1;
        opacity: 0.3;
        filter: blur(4px);
      }

      /* å†…éƒ¨å®¹å™¨ï¼Œç¡®ä¿æ‰€æœ‰ tab ä»¥ä¸€è¡Œæ˜¾ç¤º */
      .tabs-inner {
        display: flex;
        align-items: center;
        flex-wrap: nowrap;
        position: relative;
        z-index: 2;
        min-width: 100%;
      }

      /* å•ä¸ªæ ‡ç­¾æ ·å¼ - å¢å¼ºç‰ˆ */
      .tab-item {
        display: flex;
        justify-content: center;
        align-items: center;
        border-radius: 50px;
        font-size: 14px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
        padding: 14px 20px;
        color: rgba(255, 255, 255, 0.6);
        position: relative;
        white-space: nowrap;
        z-index: 3;
        user-select: none;
        min-width: fit-content;
        backdrop-filter: blur(10px);
      }

      /* æ‚¬åœæ—¶é«˜äº® */
      .tab-item:hover {
        color: rgba(255, 255, 255, 0.9);
        transform: translateY(-1px);
      }

      /* é€‰ä¸­çš„ tab é«˜äº® - ç§»é™¤èƒŒæ™¯è‰²ï¼Œå› ä¸ºç°åœ¨ç”¨æ»‘åŠ¨æ¨ªæ¡ */
      .tab-item.active {
        color: rgba(255, 255, 255, 0.95);
        font-weight: 600;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      }

      /* åˆ†éš”çº¿æ ·å¼ä¼˜åŒ– */
      .tab-item:not(:last-child)::after {
        content: "";
        position: absolute;
        right: 0;
        width: 1px;
        height: 20px;
        background: linear-gradient(to bottom, 
          transparent 0%, 
          rgba(255, 255, 255, 0.2) 50%, 
          transparent 100%);
        opacity: 0.6;
        transition: opacity 0.3s ease;
      }

      /* å½“tabè¢«é€‰ä¸­æ—¶ï¼Œéšè—ç›¸é‚»çš„åˆ†éš”çº¿ */
      .tab-item.active::after,
      .tab-item.active + .tab-item::before {
        opacity: 0;
      }

      /* ä¸ºåˆ†éš”çº¿æ·»åŠ å‰ç½®ä¼ªå…ƒç´  */
      .tab-item:not(:first-child)::before {
        content: "";
        position: absolute;
        left: 0;
        width: 1px;
        height: 20px;
        background: linear-gradient(to bottom, 
          transparent 0%, 
          rgba(255, 255, 255, 0.2) 50%, 
          transparent 100%);
        opacity: 0.6;
        transition: opacity 0.3s ease;
      }

      /* æ€§èƒ½ç›‘æ§é¢æ¿ */
      .performance-panel {
        background: rgba(0, 0, 0, 0.2);
        backdrop-filter: blur(10px);
        border-radius: 10px;
        padding: 15px;
        margin-top: 20px;
        font-family: 'Courier New', monospace;
        font-size: 12px;
        color: rgba(255, 255, 255, 0.8);
        border: 1px solid rgba(255, 255, 255, 0.1);
        display: none;
      }

      .performance-panel.show {
        display: block;
      }

      /* åŠ è½½çŠ¶æ€ */
      .loading-state {
        opacity: 0.7;
        pointer-events: none;
      }

      /* é”™è¯¯çŠ¶æ€ */
      .error-state {
        color: #ff6b6b;
        background: rgba(255, 107, 107, 0.1);
      }

      /* å“åº”å¼è®¾è®¡ */
      @media (max-width: 768px) {
        .title {
          font-size: 2rem;
        }

        .tabs-container {
          padding: 4px;
          border-radius: 25px;
        }
        
        .tab-item {
          font-size: 13px;
          padding: 12px 16px;
        }

        .sliding-indicator {
          top: 4px;
          left: 4px;
          height: calc(100% - 8px);
        }

        .stats {
          flex-direction: column;
          gap: 15px;
        }

        .controls {
          flex-direction: column;
          align-items: center;
        }
      }

      @media (max-width: 480px) {
        .main-container {
          padding: 15px;
        }

        .tabs-container {
          padding: 3px;
        }
        
        .tab-item {
          font-size: 12px;
          padding: 10px 14px;
        }

        .sliding-indicator {
          top: 3px;
          left: 3px;
          height: calc(100% - 6px);
        }
      }

      /* æ·±è‰²ä¸»é¢˜æ”¯æŒ */
      @media (prefers-color-scheme: dark) {
        .tabs-container {
          background: rgba(20, 20, 20, 0.9);
        }
      }

      /* å‡å°‘åŠ¨ç”»åå¥½æ”¯æŒ */
      @media (prefers-reduced-motion: reduce) {
        .sliding-indicator,
        .tab-item {
          transition: none;
        }
      }

      /* é«˜å¯¹æ¯”åº¦æ”¯æŒ */
      @media (prefers-contrast: high) {
        .tab-item {
          border: 1px solid rgba(255, 255, 255, 0.5);
        }
        
        .sliding-indicator {
          border: 2px solid #fff;
        }
      }
    </style>
  </head>
  <body>
    <div class="main-container">
      <!-- æ ‡é¢˜ -->
      <h1 class="title">ğŸš€ ç°ä»£åŒ–æ»‘åŠ¨Tabç»„ä»¶</h1>

      <!-- æ§åˆ¶é¢æ¿ -->
      <div class="controls">
        <button class="btn" onclick="toggleDebugMode()" id="debugBtn">ğŸ› è°ƒè¯•æ¨¡å¼</button>
        <button class="btn" onclick="togglePerformanceMonitor()" id="perfBtn">ğŸ“Š æ€§èƒ½ç›‘æ§</button>
        <button class="btn" onclick="addRandomTab()">â• æ·»åŠ Tab</button>
        <button class="btn" onclick="removeLastTab()">â– åˆ é™¤Tab</button>
        <button class="btn" onclick="resetTabs()">ğŸ”„ é‡ç½®</button>
      </div>

      <!-- ç»Ÿè®¡ä¿¡æ¯ -->
      <div class="stats">
        <div class="stat-item">
          <span class="stat-number" id="totalTabs">6</span>
          <div class="stat-label">æ€»Tabæ•°</div>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="activeTabs">1</span>
          <div class="stat-label">æ´»è·ƒTab</div>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="switchCount">0</span>
          <div class="stat-label">åˆ‡æ¢æ¬¡æ•°</div>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="avgSwitchTime">0ms</span>
          <div class="stat-label">å¹³å‡åˆ‡æ¢æ—¶é—´</div>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="performanceScore">100</span>
          <div class="stat-label">æ€§èƒ½è¯„åˆ†</div>
        </div>
      </div>

      <div class="body-box">
        <!-- å¯æ»šåŠ¨çš„ tab å®¹å™¨ -->
        <div class="tabs-container" id="tabsContainer">
          <!-- æ»‘åŠ¨æ¨ªæ¡æŒ‡ç¤ºå™¨ -->
          <div class="sliding-indicator" id="slidingIndicator"></div>
          
          <div class="tabs-inner" id="tabsInner">
            <!-- æ¯ä¸ª tab å…·æœ‰å”¯ä¸€çš„ data-key å€¼ -->
            <div class="tab-item" data-key="Tab1">é¦–é¡µ</div>
            <div class="tab-item" data-key="Tab2">äº§å“ä¸­å¿ƒ</div>
            <div class="tab-item" data-key="Tab3">è§£å†³æ–¹æ¡ˆ</div>
            <div class="tab-item" data-key="Tab4">æŠ€æœ¯æ”¯æŒ</div>
            <div class="tab-item" data-key="Tab5">å…³äºæˆ‘ä»¬</div>
            <div class="tab-item" data-key="Tab6">è”ç³»æˆ‘ä»¬</div>
          </div>
        </div>
      </div>

      <!-- æ€§èƒ½ç›‘æ§é¢æ¿ -->
      <div class="performance-panel" id="performancePanel">
        <div><strong>æ€§èƒ½ç›‘æ§é¢æ¿</strong></div>
        <div>æ¸²æŸ“æ—¶é—´: <span id="renderTime">0ms</span></div>
        <div>å†…å­˜ä½¿ç”¨: <span id="memoryUsage">0MB</span></div>
        <div>FPS: <span id="fps">60</span></div>
        <div>äº‹ä»¶ç›‘å¬å™¨: <span id="eventListeners">0</span></div>
      </div>
    </div>

    <script>
      /**
       * ç°ä»£åŒ–Tabæ»‘åŠ¨ç»„ä»¶ç±» - ä¼˜åŒ–ç‰ˆ
       */
      class ModernSlidingTabs {
        constructor(options = {}) {
          // é»˜è®¤é…ç½®
          this.options = {
            container: '#tabsContainer',
            indicator: '#slidingIndicator',
            tabSelector: '.tab-item',
            animationDuration: 400,
            scrollBehavior: 'smooth',
            debug: false,
            enablePerformanceMonitor: false,
            enableAccessibility: true,
            enableKeyboardNavigation: true,
            throttleDelay: 16, // 60fps
            debounceDelay: 100,
            ...options,
          };

          // çŠ¶æ€ç®¡ç†
          this.state = {
            activeTab: null,
            isAnimating: false,
            switchCount: 0,
            switchTimes: [],
            startTime: Date.now(),
          };

          // æ€§èƒ½ç›‘æ§
          this.performance = {
            renderTimes: [],
            memoryUsage: 0,
            fps: 60,
            eventListeners: 0,
          };

          // DOM å…ƒç´ 
          this.elements = {
            container: null,
            indicator: null,
            tabs: null,
            tabsInner: null,
          };

          // äº‹ä»¶å¤„ç†å™¨
          this.handlers = new Map();

          // åˆå§‹åŒ–
          this.init();
        }

        init() {
          this.log('åˆå§‹åŒ–ç°ä»£åŒ–Tabç»„ä»¶...');
          
          try {
            this.initElements();
            this.bindEvents();
            this.initAccessibility();
            this.setInitialState();
            
            if (this.options.enablePerformanceMonitor) {
              this.startPerformanceMonitor();
            }
            
            this.log('Tabç»„ä»¶åˆå§‹åŒ–å®Œæˆ');
          } catch (error) {
            this.error('åˆå§‹åŒ–å¤±è´¥:', error);
          }
        }

        initElements() {
          this.elements.container = document.querySelector(this.options.container);
          this.elements.indicator = document.querySelector(this.options.indicator);
          this.elements.tabsInner = this.elements.container.querySelector('.tabs-inner');
          
          if (!this.elements.container || !this.elements.indicator) {
            throw new Error('å¿…è¦çš„DOMå…ƒç´ æœªæ‰¾åˆ°');
          }

          this.updateTabElements();
        }

        updateTabElements() {
          this.elements.tabs = this.elements.container.querySelectorAll(this.options.tabSelector);
          this.updateStats();
        }

        bindEvents() {
          // Tabç‚¹å‡»äº‹ä»¶
          this.addEventHandler('click', this.elements.container, (e) => {
            const tab = e.target.closest(this.options.tabSelector);
            if (tab && !tab.classList.contains('active')) {
              this.switchToTab(tab);
            }
          });

          // é”®ç›˜å¯¼èˆª
          if (this.options.enableKeyboardNavigation) {
            this.addEventHandler('keydown', this.elements.container, (e) => {
              this.handleKeyboardNavigation(e);
            });
          }

          // çª—å£å¤§å°å˜åŒ–
          this.addEventHandler('resize', window, this.throttle(() => {
            this.updateIndicatorPosition();
          }, this.options.throttleDelay));

          // å®¹å™¨æ»šåŠ¨
          this.addEventHandler('scroll', this.elements.container, this.throttle(() => {
            this.updateIndicatorPosition();
          }, this.options.throttleDelay));

          // URLå‚æ•°ç›‘å¬
          this.addEventHandler('popstate', window, () => {
            this.handleUrlChange();
          });

          // é¡µé¢å¯è§æ€§å˜åŒ–
          this.addEventHandler('visibilitychange', document, () => {
            if (!document.hidden) {
              this.updateIndicatorPosition();
            }
          });
        }

        addEventHandler(event, element, handler) {
          element.addEventListener(event, handler);
          this.handlers.set(`${event}_${element}`, handler);
          this.performance.eventListeners++;
        }

        removeEventHandler(event, element) {
          const handler = this.handlers.get(`${event}_${element}`);
          if (handler) {
            element.removeEventListener(event, handler);
            this.handlers.delete(`${event}_${element}`);
            this.performance.eventListeners--;
          }
        }

        initAccessibility() {
          if (!this.options.enableAccessibility) return;

          // æ·»åŠ ARIAå±æ€§
          this.elements.container.setAttribute('role', 'tablist');
          this.elements.container.setAttribute('aria-label', 'å¯¼èˆªæ ‡ç­¾');

          this.elements.tabs.forEach((tab, index) => {
            tab.setAttribute('role', 'tab');
            tab.setAttribute('tabindex', index === 0 ? '0' : '-1');
            tab.setAttribute('aria-selected', 'false');
            tab.setAttribute('id', `tab-${index}`);
          });
        }

        setInitialState() {
          // è®¾ç½®åˆå§‹æ´»è·ƒTab
          const urlParams = new URLSearchParams(window.location.search);
          const tabValue = urlParams.get('tab');
          
          let initialTab = this.elements.tabs[0];
          
          if (tabValue) {
            const targetTab = Array.from(this.elements.tabs).find(
              tab => tab.getAttribute('data-key') === tabValue
            );
            if (targetTab) {
              initialTab = targetTab;
            }
          }

          this.switchToTab(initialTab, false);
        }

        switchToTab(targetTab, animate = true) {
          if (this.state.isAnimating || !targetTab) return;

          const startTime = performance.now();
          this.state.isAnimating = true;

          // æ›´æ–°æ´»è·ƒçŠ¶æ€
          if (this.state.activeTab) {
            this.state.activeTab.classList.remove('active');
            this.state.activeTab.setAttribute('aria-selected', 'false');
            this.state.activeTab.setAttribute('tabindex', '-1');
          }

          targetTab.classList.add('active');
          targetTab.setAttribute('aria-selected', 'true');
          targetTab.setAttribute('tabindex', '0');
          this.state.activeTab = targetTab;

          // æ›´æ–°URL
          this.updateUrl(targetTab.getAttribute('data-key'));

          // æ›´æ–°æŒ‡ç¤ºå™¨ä½ç½®
          this.updateIndicatorPosition(animate);

          // æ»šåŠ¨åˆ°å¯è§åŒºåŸŸ
          this.scrollToActiveTab();

          // ç»Ÿè®¡ä¿¡æ¯
          this.state.switchCount++;
          const switchTime = performance.now() - startTime;
          this.state.switchTimes.push(switchTime);
          this.updateStats();

          // åŠ¨ç”»å®Œæˆå›è°ƒ
          setTimeout(() => {
            this.state.isAnimating = false;
            this.log('Tabåˆ‡æ¢å®Œæˆ:', targetTab.textContent, 'è€—æ—¶:', switchTime.toFixed(2) + 'ms');
          }, animate ? this.options.animationDuration : 0);

          // è§¦å‘è‡ªå®šä¹‰äº‹ä»¶
          this.dispatchEvent('tabchange', {
            activeTab: targetTab,
            switchTime: switchTime,
          });
        }

        updateIndicatorPosition(animate = true) {
          if (!this.state.activeTab || !this.elements.indicator) return;

          const containerRect = this.elements.container.getBoundingClientRect();
          const activeRect = this.state.activeTab.getBoundingClientRect();
          
          // è®¡ç®—ç›¸å¯¹äºå®¹å™¨çš„ä½ç½®
          const left = activeRect.left - containerRect.left - 6; // å‡å»å®¹å™¨çš„padding
          const width = activeRect.width;
          
          // æ›´æ–°æ»‘åŠ¨æ¨ªæ¡çš„ä½ç½®å’Œå¤§å°
          this.elements.indicator.style.width = width + 'px';
          this.elements.indicator.style.transform = `translateX(${left}px)`;
          
          if (!animate) {
            this.elements.indicator.style.transition = 'none';
            requestAnimationFrame(() => {
              this.elements.indicator.style.transition = '';
            });
          }
        }

        scrollToActiveTab() {
          if (!this.state.activeTab) return;

          const containerRect = this.elements.container.getBoundingClientRect();
          const activeRect = this.state.activeTab.getBoundingClientRect();
          const containerScrollLeft = this.elements.container.scrollLeft;
          const containerWidth = this.elements.container.clientWidth;
          const activeWidth = this.state.activeTab.clientWidth;

          let targetScrollLeft = containerScrollLeft;

          if (activeRect.left < containerRect.left) {
            // å·¦ä¾§è¶…å‡º
            targetScrollLeft = this.state.activeTab.offsetLeft - 20;
          } else if (activeRect.right > containerRect.right) {
            // å³ä¾§è¶…å‡º
            targetScrollLeft = this.state.activeTab.offsetLeft - containerWidth + activeWidth + 20;
          }

          this.elements.container.scrollTo({
            left: targetScrollLeft,
            behavior: this.options.scrollBehavior,
          });
        }

        handleKeyboardNavigation(e) {
          const currentIndex = Array.from(this.elements.tabs).indexOf(this.state.activeTab);
          let targetIndex = currentIndex;

          switch (e.key) {
            case 'ArrowLeft':
              targetIndex = Math.max(0, currentIndex - 1);
              break;
            case 'ArrowRight':
              targetIndex = Math.min(this.elements.tabs.length - 1, currentIndex + 1);
              break;
            case 'Home':
              targetIndex = 0;
              break;
            case 'End':
              targetIndex = this.elements.tabs.length - 1;
              break;
            default:
              return;
          }

          if (targetIndex !== currentIndex) {
            e.preventDefault();
            this.switchToTab(this.elements.tabs[targetIndex]);
            this.elements.tabs[targetIndex].focus();
          }
        }

        handleUrlChange() {
          const urlParams = new URLSearchParams(window.location.search);
          const tabValue = urlParams.get('tab');
          
          if (tabValue) {
            const targetTab = Array.from(this.elements.tabs).find(
              tab => tab.getAttribute('data-key') === tabValue
            );
            if (targetTab && targetTab !== this.state.activeTab) {
              this.switchToTab(targetTab);
            }
          }
        }

        updateUrl(tabKey) {
          const url = new URL(window.location);
          url.searchParams.set('tab', tabKey);
          window.history.replaceState({}, '', url);
        }

        addTab(text, key) {
          const newTab = document.createElement('div');
          newTab.className = 'tab-item';
          newTab.setAttribute('data-key', key || `Tab${Date.now()}`);
          newTab.textContent = text;
          
          if (this.options.enableAccessibility) {
            const index = this.elements.tabs.length;
            newTab.setAttribute('role', 'tab');
            newTab.setAttribute('tabindex', '-1');
            newTab.setAttribute('aria-selected', 'false');
            newTab.setAttribute('id', `tab-${index}`);
          }

          this.elements.tabsInner.appendChild(newTab);
          this.updateTabElements();
          
          this.log('æ·»åŠ Tab:', text);
          return newTab;
        }

        removeTab(tab) {
          if (this.elements.tabs.length <= 1) {
            this.warn('è‡³å°‘éœ€è¦ä¿ç•™ä¸€ä¸ªTab');
            return false;
          }

          const isActive = tab === this.state.activeTab;
          const tabIndex = Array.from(this.elements.tabs).indexOf(tab);
          
          tab.remove();
          this.updateTabElements();

          if (isActive) {
            // å¦‚æœåˆ é™¤çš„æ˜¯æ´»è·ƒTabï¼Œåˆ‡æ¢åˆ°ç›¸é‚»Tab
            const newActiveIndex = Math.min(tabIndex, this.elements.tabs.length - 1);
            this.switchToTab(this.elements.tabs[newActiveIndex]);
          }

          this.log('åˆ é™¤Tab:', tab.textContent);
          return true;
        }

        updateStats() {
          document.getElementById('totalTabs').textContent = this.elements.tabs.length;
          document.getElementById('activeTabs').textContent = this.state.activeTab ? 1 : 0;
          document.getElementById('switchCount').textContent = this.state.switchCount;
          
          const avgTime = this.state.switchTimes.length > 0
            ? Math.round(this.state.switchTimes.reduce((a, b) => a + b, 0) / this.state.switchTimes.length)
            : 0;
          document.getElementById('avgSwitchTime').textContent = avgTime + 'ms';

          // æ€§èƒ½è¯„åˆ†è®¡ç®—
          const performanceScore = Math.max(0, 100 - Math.floor(avgTime / 10));
          document.getElementById('performanceScore').textContent = performanceScore;
        }

        startPerformanceMonitor() {
          setInterval(() => {
            this.updatePerformanceStats();
          }, 1000);
        }

        updatePerformanceStats() {
          // å†…å­˜ä½¿ç”¨æƒ…å†µ
          if (performance.memory) {
            this.performance.memoryUsage = Math.round(performance.memory.usedJSHeapSize / 1024 / 1024);
            document.getElementById('memoryUsage').textContent = this.performance.memoryUsage + 'MB';
          }

          // äº‹ä»¶ç›‘å¬å™¨æ•°é‡
          document.getElementById('eventListeners').textContent = this.performance.eventListeners;

          // FPSç›‘æ§ï¼ˆç®€åŒ–ç‰ˆï¼‰
          let lastTime = performance.now();
          let frames = 0;
          const measureFPS = () => {
            frames++;
            const currentTime = performance.now();
            if (currentTime >= lastTime + 1000) {
              this.performance.fps = Math.round((frames * 1000) / (currentTime - lastTime));
              document.getElementById('fps').textContent = this.performance.fps;
              frames = 0;
              lastTime = currentTime;
            }
            requestAnimationFrame(measureFPS);
          };
          measureFPS();
        }

        dispatchEvent(eventName, detail) {
          const event = new CustomEvent(eventName, { detail });
          this.elements.container.dispatchEvent(event);
        }

        // å·¥å…·å‡½æ•°
        throttle(func, delay) {
          let timeoutId;
          let lastExecTime = 0;
          return function (...args) {
            const currentTime = Date.now();
            
            if (currentTime - lastExecTime > delay) {
              func.apply(this, args);
              lastExecTime = currentTime;
            } else {
              clearTimeout(timeoutId);
              timeoutId = setTimeout(() => {
                func.apply(this, args);
                lastExecTime = Date.now();
              }, delay - (currentTime - lastExecTime));
            }
          };
        }

        debounce(func, delay) {
          let timeoutId;
          return function (...args) {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(() => func.apply(this, args), delay);
          };
        }

        destroy() {
          // æ¸…ç†äº‹ä»¶ç›‘å¬å™¨
          this.handlers.forEach((handler, key) => {
            const [event, element] = key.split('_');
            element.removeEventListener(event, handler);
          });
          this.handlers.clear();

          // æ¸…ç†çŠ¶æ€
          this.state = {};
          this.elements = {};
          
          this.log('Tabç»„ä»¶å·²é”€æ¯');
        }

        log(...args) {
          if (this.options.debug) {
            console.log('[ModernSlidingTabs]', ...args);
          }
        }

        warn(...args) {
          console.warn('[ModernSlidingTabs]', ...args);
        }

        error(...args) {
          console.error('[ModernSlidingTabs]', ...args);
        }
      }

      // å…¨å±€å˜é‡
      let tabsInstance;
      let debugMode = false;
      let performanceMode = false;

      // åˆå§‹åŒ–
      document.addEventListener("DOMContentLoaded", function () {
        initTabs();
      });

      function initTabs() {
        tabsInstance = new ModernSlidingTabs({
          debug: debugMode,
          enablePerformanceMonitor: performanceMode,
        });

        // ç›‘å¬Tabåˆ‡æ¢äº‹ä»¶
        document.getElementById('tabsContainer').addEventListener('tabchange', (e) => {
          console.log('Tabåˆ‡æ¢äº‹ä»¶:', e.detail);
        });
      }

      // å…¨å±€å‡½æ•°
      function toggleDebugMode() {
        debugMode = !debugMode;
        const btn = document.getElementById('debugBtn');
        btn.textContent = debugMode ? 'ğŸ› è°ƒè¯•æ¨¡å¼ (å¼€)' : 'ğŸ› è°ƒè¯•æ¨¡å¼';
        btn.classList.toggle('active', debugMode);
        
        // é‡æ–°åˆå§‹åŒ–ä»¥åº”ç”¨è°ƒè¯•æ¨¡å¼
        if (tabsInstance) {
          tabsInstance.destroy();
          initTabs();
        }
      }

      function togglePerformanceMonitor() {
        performanceMode = !performanceMode;
        const btn = document.getElementById('perfBtn');
        const panel = document.getElementById('performancePanel');
        
        btn.textContent = performanceMode ? 'ğŸ“Š æ€§èƒ½ç›‘æ§ (å¼€)' : 'ğŸ“Š æ€§èƒ½ç›‘æ§';
        btn.classList.toggle('active', performanceMode);
        panel.classList.toggle('show', performanceMode);
        
        if (tabsInstance) {
          tabsInstance.destroy();
          initTabs();
        }
      }

      function addRandomTab() {
        if (!tabsInstance) return;
        
        const names = ['æ–°åŠŸèƒ½', 'çƒ­é—¨æ¨è', 'æœ€æ–°èµ„è®¯', 'ç”¨æˆ·ä¸­å¿ƒ', 'è®¾ç½®', 'å¸®åŠ©'];
        const randomName = names[Math.floor(Math.random() * names.length)];
        const randomKey = `Tab${Date.now()}`;
        
        tabsInstance.addTab(randomName, randomKey);
      }

      function removeLastTab() {
        if (!tabsInstance || tabsInstance.elements.tabs.length <= 1) return;
        
        const lastTab = tabsInstance.elements.tabs[tabsInstance.elements.tabs.length - 1];
        tabsInstance.removeTab(lastTab);
      }

      function resetTabs() {
        if (!tabsInstance) return;
        
        tabsInstance.destroy();
        
        // é‡ç½®HTML
        document.getElementById('tabsInner').innerHTML = `
          <div class="tab-item" data-key="Tab1">é¦–é¡µ</div>
          <div class="tab-item" data-key="Tab2">äº§å“ä¸­å¿ƒ</div>
          <div class="tab-item" data-key="Tab3">è§£å†³æ–¹æ¡ˆ</div>
          <div class="tab-item" data-key="Tab4">æŠ€æœ¯æ”¯æŒ</div>
          <div class="tab-item" data-key="Tab5">å…³äºæˆ‘ä»¬</div>
          <div class="tab-item" data-key="Tab6">è”ç³»æˆ‘ä»¬</div>
        `;
        
        initTabs();
      }
    </script>
  </body>
</html>