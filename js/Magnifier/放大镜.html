<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>图片放大镜效果</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        background-color: #f5f5f5;
        font-family: Arial, sans-serif;
      }

      .box {
        position: relative;
        padding: 20px;
        background: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        display: inline-block;
      }

      .yuantu {
        position: relative;
        width: 400px;
        height: 400px;
        border: 2px solid #ddd;
        border-radius: 4px;
        overflow: hidden;
        cursor: crosshair;
      }

      .yuantu img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        user-select: none;
        pointer-events: none;
      }

      .mask {
        position: absolute;
        display: none;
        width: 200px;
        height: 200px;
        background-color: rgba(255, 255, 255, 0.3);
        border: 2px solid #007bff;
        border-radius: 4px;
        pointer-events: none;
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.1);
      }

      .enlarge {
        position: absolute;
        border: 2px solid #007bff;
        border-radius: 4px;
        left: 440px;
        top: 20px;
        width: 400px;
        height: 400px;
        overflow: hidden;
        display: none;
        background: white;
        z-index: 1000;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      }

      .enlarge img {
        position: absolute;
        width: 800px;
        height: 800px;
        object-fit: cover;
        user-select: none;
        pointer-events: none;
      }

      .info {
        margin-top: 20px;
        text-align: center;
        color: #666;
      }

      .info a {
        color: #007bff;
        text-decoration: none;
      }

      .info a:hover {
        text-decoration: underline;
      }

      /* 响应式设计 */
      @media (max-width: 900px) {
        .enlarge {
          left: 320px;
          width: 300px;
          height: 300px;
        }

        .yuantu {
          width: 300px;
          height: 300px;
        }

        .enlarge img {
          width: 600px;
          height: 600px;
        }
      }

      @media (max-width: 700px) {
        .enlarge {
          left: 10px;
          top: 320px;
          width: 280px;
          height: 280px;
        }

        .yuantu {
          width: 280px;
          height: 280px;
        }

        .enlarge img {
          width: 560px;
          height: 560px;
        }
      }
    </style>
  </head>
  <body>
    <div class="box">
      <!--原图  -->
      <div class="yuantu">
        <img src="./img/1.png" alt="原图" />
        <!-- 蒙版 -->
        <div class="mask"></div>
      </div>

      <!-- 放大图 -->
      <div class="enlarge">
        <img src="./img/1.png" alt="放大图" />
      </div>
    </div>

    <div class="info">
      <h4>
        <a href="https://blog.csdn.net/qq_42877027/article/details/104959525"
          >参考源码</a
        >
      </h4>
      <p>将鼠标悬停在左侧图片上查看放大效果</p>
    </div>

    <script>
      // 获取DOM元素
      const yuantu = document.querySelector(".yuantu");
      const enlargeImg = document.querySelector(".enlarge img");
      const enlarge = document.querySelector(".enlarge");
      const mask = document.querySelector(".mask");

      // 防抖函数
      function debounce(func, wait) {
        let timeout;
        return function executedFunction(...args) {
          const later = () => {
            clearTimeout(timeout);
            func(...args);
          };
          clearTimeout(timeout);
          timeout = setTimeout(later, wait);
        };
      }

      // 计算元素相对于文档的偏移量
      function getOffset(element) {
        const rect = element.getBoundingClientRect();
        return {
          left: rect.left + window.scrollX,
          top: rect.top + window.scrollY,
        };
      }

      // 限制值在指定范围内
      function clamp(value, min, max) {
        return Math.min(Math.max(value, min), max);
      }

      // 处理鼠标移动事件
      function handleMouseMove(e) {
        const offset = getOffset(yuantu);
        const maskHalfWidth = mask.offsetWidth / 2;
        const maskHalfHeight = mask.offsetHeight / 2;

        // 计算蒙版位置（以蒙版中心跟随鼠标）
        let left = e.clientX - offset.left - maskHalfWidth;
        let top = e.clientY - offset.top - maskHalfHeight;

        // 限制蒙版在原图范围内
        const maxLeft = yuantu.offsetWidth - mask.offsetWidth;
        const maxTop = yuantu.offsetHeight - mask.offsetHeight;

        left = clamp(left, 0, maxLeft);
        top = clamp(top, 0, maxTop);

        // 设置蒙版位置
        mask.style.left = left + "px";
        mask.style.top = top + "px";

        // 计算放大图的移动比例
        const scaleX = left / maxLeft;
        const scaleY = top / maxTop;

        // 计算放大图的最大移动距离
        const maxMoveX = enlargeImg.offsetWidth - enlarge.offsetWidth;
        const maxMoveY = enlargeImg.offsetHeight - enlarge.offsetHeight;

        // 设置放大图位置
        enlargeImg.style.left = -maxMoveX * scaleX + "px";
        enlargeImg.style.top = -maxMoveY * scaleY + "px";
      }

      // 防抖处理的鼠标移动事件
      const debouncedMouseMove = debounce(handleMouseMove, 16); // 约60fps

      // 鼠标进入事件
      yuantu.addEventListener("mouseenter", function () {
        enlarge.style.display = "block";
        mask.style.display = "block";
      });

      // 鼠标移动事件
      yuantu.addEventListener("mousemove", handleMouseMove);

      // 鼠标离开事件
      yuantu.addEventListener("mouseleave", function () {
        enlarge.style.display = "none";
        mask.style.display = "none";
      });

      // 错误处理：如果图片加载失败
      const images = document.querySelectorAll("img");
      images.forEach((img) => {
        img.addEventListener("error", function () {
          console.warn("图片加载失败:", this.src);
          this.style.background = "#f0f0f0";
          this.alt = "图片加载失败";
        });
      });
    </script>
  </body>
</html>
