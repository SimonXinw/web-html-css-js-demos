<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>动态生成视频轮播</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/swiper@10/swiper-bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }
      body {
        background: #000;
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      .swiper-container {
        width: 80vw;
        height: 40vh;
        overflow: hidden;
      }
      .swiper-wrapper {
        display: flex;
        align-items: center;
      }
      .swiper-slide {
        position: relative;
        display: flex;
        justify-content: center;
        align-items: center;
        width: 100%;
      }

      video {
        width: 100%;
        height: 100%;
        object-fit: cover;
        border-radius: 8px;
      }

      /* 进度条 */
      .progress-bar {
        position: absolute;
        bottom: 5px;
        left: 10px;
        width: calc(100% - 20px);
        height: 4px;
        background: rgba(255, 255, 255, 0.3);
        border-radius: 4px;
        overflow: hidden;
      }
      .progress {
        width: 0;
        height: 100%;
        background: #ffcc00;
      }
    </style>
  </head>
  <body>
    <div class="swiper-container">
      <div class="swiper-wrapper" id="video-slider"></div>
    </div>

    <script>
      $(document).ready(function () {
        const videoUrls = [
          "https://cdn.shopify.com/videos/c/o/v/32920ef6f01c461cb5a5695464e03e40.webm",
          "https://cdn.shopify.com/videos/c/o/v/32920ef6f01c461cb5a5695464e03e40.webm",
          "https://cdn.shopify.com/videos/c/o/v/32920ef6f01c461cb5a5695464e03e40.webm",
          "https://cdn.shopify.com/videos/c/o/v/32920ef6f01c461cb5a5695464e03e40.webm",
          "https://cdn.shopify.com/videos/c/o/v/32920ef6f01c461cb5a5695464e03e40.webm",
          "https://cdn.shopify.com/videos/c/o/v/32920ef6f01c461cb5a5695464e03e40.webm",
        ];

        const sliderContainer = $("#video-slider");

        // 动态生成 Swiper 轮播项
        videoUrls.forEach((url, index) => {
          const slide = $(`
                    <div class="swiper-slide">
                        <video src="${url}" muted></video>
                        <div class="progress-bar"><div class="progress"></div></div>
                    </div>
                `);
          sliderContainer.append(slide);
        });

        // 初始化 Swiper
        const swiper = new Swiper(".swiper-container", {
          loop: true,
          slidesPerView: 4,
          spaceBetween: 10,
          autoplay: false,
        });

        // 获取所有视频元素
        const videos = document.querySelectorAll("video");

        function playVideos() {
          videos.forEach((video, index) => {
            const progressBar = video.parentElement.querySelector(".progress");

            // 重置进度条
            gsap.set(progressBar, { width: "0%" });

            // 确保视频从头开始播放
            video.currentTime = 0;
            video.play();

            // 进度条动画
            gsap.to(progressBar, {
              width: "100%",
              duration: video.duration || 5, // 防止 duration 还未加载出来
              ease: "linear",
              onComplete: () => {
                video.currentTime = 0; // 重置视频
                video.play(); // 重新播放
                playVideos(); // 递归触发下一轮
              },
            });

            // 监听视频结束，重播
            video.onended = function () {
              video.currentTime = 0;
              video.play();
              playVideos();
            };
          });
        }

        // 确保所有视频都自动播放
        playVideos();
      });
    </script>
  </body>
</html>
