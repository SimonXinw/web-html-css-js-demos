<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Skeleton Loading</title>
    <style>
      body {
        margin: 0;
        padding: 40px;
        background-color: #f5f5f5;
        font-family: sans-serif;
      }

      .visit_showroom_list {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 24px;
      }

      .visit_showroom_list .list_item {
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
        overflow: hidden;
      }

      @keyframes skeleton-loading {
        0% {
          background-position: 100% 50%;
        }
        100% {
          background-position: 0 50%;
        }
      }

      .visit_showroom_list .skeleton {
        border-radius: 4px;
        background-color: var(--Color-card_fill-white_Hover, #ececed);
        background-image: linear-gradient(
          90deg,
          rgba(0, 0, 0, 0.06) 25%,
          rgba(0, 0, 0, 0.15) 37%,
          rgba(0, 0, 0, 0.06) 63%
        );
        background-size: 400% 100%;
        background-repeat: repeat;
        animation: skeleton-loading 1.4s infinite ease;
      }

      .visit_showroom_list .skeleton_desc_wrap {
        padding: 12px 20px 20px 20px;
      }

      .visit_showroom_list .skeleton_img {
        height: 240px;
      }

      .visit_showroom_list .skeleton_subtitle {
        height: 19px;
        width: 177px;
        margin-bottom: 12px;
      }

      .visit_showroom_list .skeleton_desc {
        height: 71px;
        margin-bottom: 20px;
      }

      .visit_showroom_list .skeleton_title {
        height: 16px;
        width: 131px;
      }

      .card_link {
        display: block;
        text-decoration: none;
        color: inherit;
        padding: 20px;
      }

      .card_link img {
        width: 100%;
        height: 240px;
        object-fit: cover;
        display: block;
        border-radius: 6px;
        margin-bottom: 12px;
      }

      .item_subtitle,
      .item_desc,
      .item_title {
        margin-bottom: 8px;
      }

      .link_to {
        display: flex;
        align-items: center;
        gap: 4px;
        color: #007aff;
        font-weight: bold;
        margin-top: 10px;
      }

      /* 骨架站位图>>>> */
      .lazy-image {
        background-color: #e0e0e0;
        display: block;
        width: 100%;
        height: auto;
        transition: opacity 0.3s ease;
        opacity: 0;
      }
      .lazy-image.loaded {
        opacity: 1;
      }
    </style>
  </head>
  <body>
    <h1>Skeleton Loading Example</h1>
    <div class="visit_showroom_list">
      <!-- 初始6个骨架项 -->
      <div class="list_item">
        <div class="skeleton skeleton_img"></div>
        <div class="skeleton_desc_wrap">
          <div class="skeleton skeleton_subtitle"></div>
          <div class="skeleton skeleton_desc"></div>
          <div class="skeleton skeleton_title"></div>
        </div>
      </div>
      <div class="list_item">
        <div class="skeleton skeleton_img"></div>
        <div class="skeleton_desc_wrap">
          <div class="skeleton skeleton_subtitle"></div>
          <div class="skeleton skeleton_desc"></div>
          <div class="skeleton skeleton_title"></div>
        </div>
      </div>
      <div class="list_item">
        <div class="skeleton skeleton_img"></div>
        <div class="skeleton_desc_wrap">
          <div class="skeleton skeleton_subtitle"></div>
          <div class="skeleton skeleton_desc"></div>
          <div class="skeleton skeleton_title"></div>
        </div>
      </div>
      <div class="list_item">
        <div class="skeleton skeleton_img"></div>
        <div class="skeleton_desc_wrap">
          <div class="skeleton skeleton_subtitle"></div>
          <div class="skeleton skeleton_desc"></div>
          <div class="skeleton skeleton_title"></div>
        </div>
      </div>
      <div class="list_item">
        <div class="skeleton skeleton_img"></div>
        <div class="skeleton_desc_wrap">
          <div class="skeleton skeleton_subtitle"></div>
          <div class="skeleton skeleton_desc"></div>
          <div class="skeleton skeleton_title"></div>
        </div>
      </div>
      <div class="list_item">
        <div class="skeleton skeleton_img"></div>
        <div class="skeleton_desc_wrap">
          <div class="skeleton skeleton_subtitle"></div>
          <div class="skeleton skeleton_desc"></div>
          <div class="skeleton skeleton_title"></div>
        </div>
      </div>
    </div>

    <!-- jQuery 引入 -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <script>
      // 你需要提供 lat / lng / show 的变量，临时用默认值占位
      const lat = 0;
      const lng = 0;
      const show = 1;

      function removeParamsFromImageUrl(url) {
        return url.split("?")[0];
      }

      function metersToMiles(meters) {
        return meters / 1609.344;
      }

      function lazyLoadImages() {
        const lazyImages = document.querySelectorAll("img.lazy-image");

        const observer = new IntersectionObserver(
          (entries, observer) => {
            entries.forEach((entry) => {
              if (entry.isIntersecting || entry.intersectionRatio > 0) {
                const img = entry.target;
                img.src = img.dataset.src;
                img.onload = () => {
                  img.classList.add("loaded");
                };
                observer.unobserve(img);
              }
            });
          },
          {
            rootMargin: "0px 0px 100px 0px",
            threshold: 0.01,
          }
        );

        lazyImages.forEach((img) => {
          observer.observe(img);
        });
      }

      $.ajax({
        url: `https://admin.awolvision.com/prod-api/system/showrooms/list?pageSize=100`,
        type: "GET",
        dataType: "json",
        contentType: "application/json",
        data: {
          pageNum: 1,
          lat: 40.7093836,
          lng: -74.0073177,
          isShow: 1,
        },
        success: function (response) {
          if (response.code !== 200) return;

          console.log("Response:", response.rows);
          let htmls = "";

          for (const row of response.rows) {
            if (row.isShow != 1) continue;

            const { id, city, country, type, tile, distance, photoList } = row;

            let image_url =
              photoList && photoList.length > 0
                ? removeParamsFromImageUrl(photoList[0].url)
                : "https://cdn.shopify.com/s/files/1/0554/7445/4576/files/thunder_room_swiper_image01.png?v=1727166601";

            let distanceStr = "";
            const numericDistance = Number(distance);

            if (numericDistance <= 0) {
              distanceStr = numericDistance.toFixed(2) + "m";
            } else {
              distanceStr = metersToMiles(numericDistance).toFixed(2) + "mi";
            }

            const typeLabel = type == 1 ? "Community Showroom" : "Retail";

            htmls += `
              <div class="list_item">
                <a class="card_link" href="https://awolvision.com/pages/showroom-details?id=${id}&distance=${distanceStr}">
                  <img data-src="${image_url}" alt="" class="lazy-image" />
                  <div class="item_subtitle">${distanceStr} | ${city}, ${country}</div>
                  <div class="item_desc">${typeLabel}</div>
                  <div class="item_title">${tile}</div>
                  <div class="link_to">
                    <span class="link--animated">VIEW SHOWROOM</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                      <path d="M13.1558 10.4402L7.51997 16.25L6.66602 15.3697L11.8749 10L6.66602 4.63032L7.51998 3.75L13.1558 9.55984C13.3916 9.80293 13.3916 10.1971 13.1558 10.4402Z" fill="currentColor"/>
                    </svg>
                  </div>
                </a>
              </div>
            `;
          }

          $(".visit_showroom_list").html(htmls);
          lazyLoadImages(); // 加载完成后启动懒加载
        },
        error: function (xhr, status, error) {
          console.error("Error:", error);
        },
      });
    </script>
  </body>
</html>
