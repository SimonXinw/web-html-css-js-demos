<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆè¯­è¿è¿çœ‹ - è°ƒè¯•ç‰ˆæœ¬</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .debug-info {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid #007bff;
        }
        .error {
            border-left-color: #dc3545;
            background: #f8d7da;
        }
        .success {
            border-left-color: #28a745;
            background: #d4edda;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
    </style>
</head>
<body>
    <h1>ğŸ”§ æˆè¯­è¿è¿çœ‹è°ƒè¯•é¡µé¢</h1>
    
    <div id="debugInfo"></div>
    
    <button onclick="testStep1()">æ­¥éª¤1: æµ‹è¯•æ•°æ®åŠ è½½</button>
    <button onclick="testStep2()">æ­¥éª¤2: æµ‹è¯•DOMå…ƒç´ </button>
    <button onclick="testStep3()">æ­¥éª¤3: æµ‹è¯•æ¸¸æˆåˆå§‹åŒ–</button>
    <button onclick="testStep4()">æ­¥éª¤4: å¯åŠ¨å®Œæ•´æ¸¸æˆ</button>
    
    <div id="gameContainer" style="display: none;">
        <!-- ç®€åŒ–çš„æ¸¸æˆç•Œé¢ç”¨äºæµ‹è¯• -->
        <div id="gameStart">å¼€å§‹ç•Œé¢</div>
        <div id="gameOver">ç»“æŸç•Œé¢</div>
        <div id="levelComplete">å…³å¡å®Œæˆ</div>
        <div id="mahjongArea">éº»å°†åŒºåŸŸ</div>
        <button id="startButton">å¼€å§‹æ¸¸æˆ</button>
        <button id="restartButton">é‡æ–°å¼€å§‹</button>
        <button id="nextLevelButton">ä¸‹ä¸€å…³</button>
        <button id="continueButton">ç»§ç»­</button>
        <span id="levelValue">1</span>
        <span id="scoreValue">0</span>
        <span id="timeValue">60</span>
        <div id="idiomMeaning">æˆè¯­å«ä¹‰</div>
        <span id="finalScore">0</span>
        <span id="finalLevel">1</span>
        <span id="finalTime">0</span>
        <span id="completedLevel">1</span>
        <span id="gameOverTitle">æ¸¸æˆç»“æŸ</span>
        <div id="char1">?</div>
        <div id="char2">?</div>
        <div id="char3">?</div>
        <div id="char4">?</div>
    </div>

    <script>
        let debugLog = [];
        
        function log(message, type = 'info') {
            debugLog.push({message, type, time: new Date().toLocaleTimeString()});
            updateDebugDisplay();
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        function updateDebugDisplay() {
            const container = document.getElementById('debugInfo');
            container.innerHTML = debugLog.map(entry => 
                `<div class="debug-info ${entry.type}">
                    <strong>[${entry.time}]</strong> ${entry.message}
                </div>`
            ).join('');
        }
        
        // æ­¥éª¤1: æµ‹è¯•æ•°æ®åŠ è½½
        function testStep1() {
            log('å¼€å§‹æµ‹è¯•æ•°æ®åŠ è½½...', 'info');
            
            // åŠ¨æ€åŠ è½½IdiomData.js
            const script = document.createElement('script');
            script.src = 'js/IdiomData.js';
            script.onload = function() {
                try {
                    if (typeof IDIOM_DATA !== 'undefined') {
                        log('âœ… IDIOM_DATA åŠ è½½æˆåŠŸ', 'success');
                        log(`ğŸ“Š æ•°æ®åŒ…å« ${Object.keys(IDIOM_DATA).length} ä¸ªå…³å¡`, 'success');
                    } else {
                        log('âŒ IDIOM_DATA æœªå®šä¹‰', 'error');
                    }
                    
                    if (typeof getLevelIdioms === 'function') {
                        const level1 = getLevelIdioms(1);
                        log(`âœ… getLevelIdioms å‡½æ•°æ­£å¸¸ï¼Œç¬¬1å…³æœ‰ ${level1.length} ä¸ªæˆè¯­`, 'success');
                        log(`ğŸ“ ç¬¬1ä¸ªæˆè¯­: ${level1[0].idiom}`, 'success');
                    } else {
                        log('âŒ getLevelIdioms å‡½æ•°æœªå®šä¹‰', 'error');
                    }
                    
                    if (typeof generateMahjongChars === 'function') {
                        const testChars = generateMahjongChars([{chars: ['ä¸€', 'äºŒ', 'ä¸‰', 'å››']}], 10);
                        log(`âœ… generateMahjongChars å‡½æ•°æ­£å¸¸ï¼Œç”Ÿæˆäº† ${testChars.length} ä¸ªå­—ç¬¦`, 'success');
                    } else {
                        log('âŒ generateMahjongChars å‡½æ•°æœªå®šä¹‰', 'error');
                    }
                    
                } catch (error) {
                    log(`âŒ æ•°æ®æµ‹è¯•å‡ºé”™: ${error.message}`, 'error');
                }
            };
            script.onerror = function() {
                log('âŒ æ— æ³•åŠ è½½ IdiomData.js æ–‡ä»¶', 'error');
            };
            document.head.appendChild(script);
        }
        
        // æ­¥éª¤2: æµ‹è¯•DOMå…ƒç´ 
        function testStep2() {
            log('å¼€å§‹æµ‹è¯•DOMå…ƒç´ ...', 'info');
            document.getElementById('gameContainer').style.display = 'block';
            
            const requiredElements = [
                'gameStart', 'gameOver', 'levelComplete', 'mahjongArea', 
                'startButton', 'restartButton', 'nextLevelButton', 'continueButton'
            ];
            
            let allFound = true;
            requiredElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    log(`âœ… æ‰¾åˆ°å…ƒç´ : ${id}`, 'success');
                } else {
                    log(`âŒ æœªæ‰¾åˆ°å…ƒç´ : ${id}`, 'error');
                    allFound = false;
                }
            });
            
            if (allFound) {
                log('âœ… æ‰€æœ‰å¿…éœ€çš„DOMå…ƒç´ éƒ½å­˜åœ¨', 'success');
            } else {
                log('âŒ éƒ¨åˆ†DOMå…ƒç´ ç¼ºå¤±', 'error');
            }
        }
        
        // æ­¥éª¤3: æµ‹è¯•æ¸¸æˆåˆå§‹åŒ–
        function testStep3() {
            log('å¼€å§‹æµ‹è¯•æ¸¸æˆåˆå§‹åŒ–...', 'info');
            
            try {
                // ç®€åŒ–çš„æ¸¸æˆç±»ç”¨äºæµ‹è¯•
                class TestIdiomGame {
                    constructor() {
                        log('æ­£åœ¨è·å–DOMå…ƒç´ ...', 'info');
                        
                        this.gameStart = document.getElementById('gameStart');
                        this.gameOver = document.getElementById('gameOver');
                        this.levelComplete = document.getElementById('levelComplete');
                        this.mahjongArea = document.getElementById('mahjongArea');
                        this.startButton = document.getElementById('startButton');
                        
                        if (!this.gameStart) {
                            throw new Error('gameStart å…ƒç´ æœªæ‰¾åˆ°');
                        }
                        if (!this.gameOver) {
                            throw new Error('gameOver å…ƒç´ æœªæ‰¾åˆ°');
                        }
                        if (!this.levelComplete) {
                            throw new Error('levelComplete å…ƒç´ æœªæ‰¾åˆ°');
                        }
                        
                        log('âœ… æ‰€æœ‰å…³é”®DOMå…ƒç´ è·å–æˆåŠŸ', 'success');
                        
                        // æµ‹è¯•åŸºæœ¬æ“ä½œ
                        this.gameStart.style.display = 'none';
                        log('âœ… gameStart.style.display è®¾ç½®æˆåŠŸ', 'success');
                        
                        this.gameStart.style.display = 'block';
                        log('âœ… DOMæ“ä½œæµ‹è¯•é€šè¿‡', 'success');
                        
                        log('âœ… æ¸¸æˆåˆå§‹åŒ–æµ‹è¯•æˆåŠŸï¼', 'success');
                    }
                }
                
                const testGame = new TestIdiomGame();
                
            } catch (error) {
                log(`âŒ æ¸¸æˆåˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                log(`é”™è¯¯å †æ ˆ: ${error.stack}`, 'error');
            }
        }
        
        // æ­¥éª¤4: å¯åŠ¨å®Œæ•´æ¸¸æˆ
        function testStep4() {
            log('å‡†å¤‡å¯åŠ¨å®Œæ•´æ¸¸æˆ...', 'info');
            
            // åŠ è½½å®Œæ•´çš„æ¸¸æˆè„šæœ¬
            const gameScript = document.createElement('script');
            gameScript.src = 'js/Game.js';
            gameScript.onload = function() {
                log('âœ… Game.js åŠ è½½æˆåŠŸ', 'success');
                
                try {
                    const fullGame = new IdiomGame();
                    log('âœ… å®Œæ•´æ¸¸æˆåˆå§‹åŒ–æˆåŠŸï¼', 'success');
                    log('ğŸ® å¯ä»¥å°è¯•ç‚¹å‡»å¼€å§‹æ¸¸æˆæŒ‰é’®', 'success');
                } catch (error) {
                    log(`âŒ å®Œæ•´æ¸¸æˆåˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                }
            };
            gameScript.onerror = function() {
                log('âŒ æ— æ³•åŠ è½½ Game.js', 'error');
            };
            document.head.appendChild(gameScript);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        window.onload = function() {
            log('ğŸš€ è°ƒè¯•é¡µé¢åŠ è½½å®Œæˆ', 'success');
            log('è¯·æŒ‰é¡ºåºç‚¹å‡»æµ‹è¯•æŒ‰é’®è¿›è¡Œè¯Šæ–­', 'info');
        };
    </script>
</body>
</html>