<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆè¯­è¿è¿çœ‹ - é€»è¾‘æµ‹è¯•</title>
    <style>
        body {
            font-family: 'Microsoft YaHei', sans-serif;
            background: #2c5530;
            color: white;
            margin: 0;
            padding: 20px;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            background: rgba(0,0,0,0.7);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 2px solid #ffd700;
        }
        .test-button {
            background: #ffd700;
            color: #8b4513;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 16px;
            font-weight: bold;
        }
        .test-button:hover {
            background: #ffed4e;
        }
        .test-result {
            background: rgba(0,0,0,0.5);
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid #ffd700;
        }
        .success { border-left-color: #90EE90; color: #90EE90; }
        .error { border-left-color: #ff4444; color: #ff4444; }
        .warning { border-left-color: #ffa500; color: #ffa500; }
        .info { border-left-color: #87ceeb; color: #87ceeb; }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ€„ æˆè¯­è¿è¿çœ‹ - é€»è¾‘æµ‹è¯•</h1>
        
        <div class="test-section">
            <h2>1. æ•°æ®ç»“æ„æµ‹è¯•</h2>
            <button class="test-button" onclick="testDataStructure()">æµ‹è¯•æˆè¯­æ•°æ®</button>
            <div id="dataTestResult"></div>
        </div>
        
        <div class="test-section">
            <h2>2. æ¸¸æˆç±»åˆå§‹åŒ–æµ‹è¯•</h2>
            <button class="test-button" onclick="testGameClass()">æµ‹è¯•æ¸¸æˆç±»</button>
            <div id="gameClassResult"></div>
        </div>
        
        <div class="test-section">
            <h2>3. DOMå…ƒç´ æµ‹è¯•</h2>
            <button class="test-button" onclick="testDOMElements()">æµ‹è¯•DOMå…ƒç´ </button>
            <div id="domTestResult"></div>
        </div>
        
        <div class="test-section">
            <h2>4. æ¸¸æˆé€»è¾‘æµ‹è¯•</h2>
            <button class="test-button" onclick="testGameLogic()">æµ‹è¯•æ¸¸æˆé€»è¾‘</button>
            <div id="logicTestResult"></div>
        </div>
        
        <div class="test-section">
            <h2>5. å®Œæ•´æ¸¸æˆ</h2>
            <a href="index.html" class="test-button" style="text-decoration: none; display: inline-block;">æ‰“å¼€å®Œæ•´æ¸¸æˆ</a>
            <a href="debug.html" class="test-button" style="text-decoration: none; display: inline-block;">æ‰“å¼€è°ƒè¯•é¡µé¢</a>
        </div>
    </div>

    <!-- åŠ è½½æ¸¸æˆè„šæœ¬ -->
    <script src="js/IdiomData.js"></script>
    
    <script>
        // æµ‹è¯•ç»“æœæ˜¾ç¤ºå‡½æ•°
        function showResult(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const result = document.createElement('div');
            result.className = `test-result ${type}`;
            result.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            container.appendChild(result);
            console.log(`[${type.toUpperCase()}] ${message}`);
        }
        
        // æ¸…ç©ºç»“æœå®¹å™¨
        function clearResults(containerId) {
            document.getElementById(containerId).innerHTML = '';
        }
        
        // 1. æµ‹è¯•æ•°æ®ç»“æ„
        function testDataStructure() {
            clearResults('dataTestResult');
            showResult('dataTestResult', 'å¼€å§‹æµ‹è¯•æˆè¯­æ•°æ®ç»“æ„...', 'info');
            
            try {
                // æ£€æŸ¥IDIOM_DATAæ˜¯å¦å­˜åœ¨
                if (typeof IDIOM_DATA === 'undefined') {
                    showResult('dataTestResult', 'âŒ IDIOM_DATA æœªå®šä¹‰', 'error');
                    return;
                }
                showResult('dataTestResult', 'âœ… IDIOM_DATA å·²åŠ è½½', 'success');
                
                // æ£€æŸ¥å…³å¡æ•°é‡
                const levelCount = Object.keys(IDIOM_DATA).length;
                showResult('dataTestResult', `ğŸ“Š æ€»å…³å¡æ•°: ${levelCount}`, 'info');
                
                // æ£€æŸ¥ç¬¬1å…³æ•°æ®
                if (typeof getLevelIdioms === 'function') {
                    const level1Data = getLevelIdioms(1);
                    showResult('dataTestResult', `âœ… getLevelIdioms å‡½æ•°æ­£å¸¸`, 'success');
                    showResult('dataTestResult', `ğŸ“ ç¬¬1å…³æˆè¯­æ•°: ${level1Data.length}`, 'info');
                    
                    if (level1Data.length > 0) {
                        const firstIdiom = level1Data[0];
                        showResult('dataTestResult', `ğŸ¯ ç¬¬1ä¸ªæˆè¯­: ${firstIdiom.idiom} (${firstIdiom.meaning})`, 'info');
                    }
                } else {
                    showResult('dataTestResult', 'âŒ getLevelIdioms å‡½æ•°æœªå®šä¹‰', 'error');
                }
                
                // æ£€æŸ¥generateMahjongCharså‡½æ•°
                if (typeof generateMahjongChars === 'function') {
                    const testChars = generateMahjongChars([{chars: ['ä¸€', 'å¿ƒ', 'ä¸€', 'æ„']}], 10);
                    showResult('dataTestResult', `âœ… generateMahjongChars å‡½æ•°æ­£å¸¸ï¼Œç”Ÿæˆ ${testChars.length} ä¸ªå­—ç¬¦`, 'success');
                } else {
                    showResult('dataTestResult', 'âŒ generateMahjongChars å‡½æ•°æœªå®šä¹‰', 'error');
                }
                
            } catch (error) {
                showResult('dataTestResult', `âŒ æ•°æ®æµ‹è¯•å‡ºé”™: ${error.message}`, 'error');
            }
        }
        
        // 2. æµ‹è¯•æ¸¸æˆç±»
        function testGameClass() {
            clearResults('gameClassResult');
            showResult('gameClassResult', 'å¼€å§‹æµ‹è¯•æ¸¸æˆç±»...', 'info');
            
            try {
                // åˆ›å»ºæ¨¡æ‹ŸDOMå…ƒç´ 
                createMockDOMElements();
                
                // åŠ¨æ€åŠ è½½Game.js
                const script = document.createElement('script');
                script.src = 'js/Game.js';
                script.onload = function() {
                    try {
                        if (typeof IdiomGame === 'undefined') {
                            showResult('gameClassResult', 'âŒ IdiomGame ç±»æœªå®šä¹‰', 'error');
                            return;
                        }
                        showResult('gameClassResult', 'âœ… IdiomGame ç±»å·²åŠ è½½', 'success');
                        
                        // å°è¯•åˆ›å»ºæ¸¸æˆå®ä¾‹
                        const game = new IdiomGame();
                        showResult('gameClassResult', 'âœ… æ¸¸æˆå®ä¾‹åˆ›å»ºæˆåŠŸ', 'success');
                        
                        // æ£€æŸ¥æ¸¸æˆæ–¹æ³•
                        const methods = ['startGame', 'initLevel', 'handleTileClick', 'updateUI'];
                        methods.forEach(method => {
                            if (typeof game[method] === 'function') {
                                showResult('gameClassResult', `âœ… ${method} æ–¹æ³•å­˜åœ¨`, 'success');
                            } else {
                                showResult('gameClassResult', `âŒ ${method} æ–¹æ³•ç¼ºå¤±`, 'error');
                            }
                        });
                        
                        // æ£€æŸ¥æ¸¸æˆå±æ€§
                        const properties = ['currentLevel', 'score', 'timeLeft', 'isGameRunning'];
                        properties.forEach(prop => {
                            if (prop in game) {
                                showResult('gameClassResult', `âœ… ${prop} å±æ€§å­˜åœ¨: ${game[prop]}`, 'success');
                            } else {
                                showResult('gameClassResult', `âŒ ${prop} å±æ€§ç¼ºå¤±`, 'error');
                            }
                        });
                        
                    } catch (error) {
                        showResult('gameClassResult', `âŒ æ¸¸æˆå®ä¾‹åˆ›å»ºå¤±è´¥: ${error.message}`, 'error');
                    }
                };
                script.onerror = function() {
                    showResult('gameClassResult', 'âŒ æ— æ³•åŠ è½½ Game.js', 'error');
                };
                document.head.appendChild(script);
                
            } catch (error) {
                showResult('gameClassResult', `âŒ æ¸¸æˆç±»æµ‹è¯•å‡ºé”™: ${error.message}`, 'error');
            }
        }
        
        // 3. æµ‹è¯•DOMå…ƒç´ 
        function testDOMElements() {
            clearResults('domTestResult');
            showResult('domTestResult', 'å¼€å§‹æµ‹è¯•DOMå…ƒç´ ...', 'info');
            
            const requiredElements = [
                'gameStart', 'gameOver', 'levelComplete', 'mahjongArea', 
                'startButton', 'restartButton', 'nextLevelButton', 'continueButton',
                'levelValue', 'scoreValue', 'timeValue', 'idiomMeaning'
            ];
            
            let foundCount = 0;
            requiredElements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    showResult('domTestResult', `âœ… ${id}: æ‰¾åˆ°`, 'success');
                    foundCount++;
                } else {
                    showResult('domTestResult', `âŒ ${id}: æœªæ‰¾åˆ°`, 'error');
                }
            });
            
            showResult('domTestResult', `ğŸ“Š DOMå…ƒç´ æ£€æŸ¥å®Œæˆ: ${foundCount}/${requiredElements.length} ä¸ªå…ƒç´ æ‰¾åˆ°`, 
                      foundCount === requiredElements.length ? 'success' : 'warning');
        }
        
        // 4. æµ‹è¯•æ¸¸æˆé€»è¾‘
        function testGameLogic() {
            clearResults('logicTestResult');
            showResult('logicTestResult', 'å¼€å§‹æµ‹è¯•æ¸¸æˆé€»è¾‘...', 'info');
            
            try {
                // æµ‹è¯•å­—ç¬¦åŒ¹é…é€»è¾‘
                if (typeof getNextRequiredChar === 'function') {
                    const testIdiom = {chars: ['ä¸€', 'å¿ƒ', 'ä¸€', 'æ„']};
                    const selected = [false, false, false, false];
                    const next = getNextRequiredChar(testIdiom, selected);
                    
                    if (next && next.char === 'ä¸€' && next.position === 0) {
                        showResult('logicTestResult', 'âœ… getNextRequiredChar å‡½æ•°æ­£å¸¸', 'success');
                    } else {
                        showResult('logicTestResult', 'âŒ getNextRequiredChar å‡½æ•°è¿”å›é”™è¯¯', 'error');
                    }
                } else {
                    showResult('logicTestResult', 'âŒ getNextRequiredChar å‡½æ•°æœªæ‰¾åˆ°', 'error');
                }
                
                // æµ‹è¯•æˆè¯­å­—ç¬¦æ£€æŸ¥
                if (typeof isCharInIdiom === 'function') {
                    const testIdiom = {chars: ['ä¸€', 'å¿ƒ', 'ä¸€', 'æ„']};
                    const result1 = isCharInIdiom('ä¸€', testIdiom);
                    const result2 = isCharInIdiom('äºŒ', testIdiom);
                    
                    if (result1 === true && result2 === false) {
                        showResult('logicTestResult', 'âœ… isCharInIdiom å‡½æ•°æ­£å¸¸', 'success');
                    } else {
                        showResult('logicTestResult', 'âŒ isCharInIdiom å‡½æ•°é€»è¾‘é”™è¯¯', 'error');
                    }
                } else {
                    showResult('logicTestResult', 'âŒ isCharInIdiom å‡½æ•°æœªæ‰¾åˆ°', 'error');
                }
                
                showResult('logicTestResult', 'ğŸ“Š æ¸¸æˆé€»è¾‘æµ‹è¯•å®Œæˆ', 'info');
                
            } catch (error) {
                showResult('logicTestResult', `âŒ æ¸¸æˆé€»è¾‘æµ‹è¯•å‡ºé”™: ${error.message}`, 'error');
            }
        }
        
        // åˆ›å»ºæ¨¡æ‹ŸDOMå…ƒç´ ç”¨äºæµ‹è¯•
        function createMockDOMElements() {
            const mockElements = [
                'gameStart', 'gameOver', 'levelComplete', 'mahjongArea', 
                'startButton', 'restartButton', 'nextLevelButton', 'continueButton',
                'levelValue', 'scoreValue', 'timeValue', 'idiomMeaning',
                'finalScore', 'finalLevel', 'finalTime', 'completedLevel', 'gameOverTitle'
            ];
            
            mockElements.forEach(id => {
                if (!document.getElementById(id)) {
                    const element = document.createElement('div');
                    element.id = id;
                    element.style.display = 'none';
                    document.body.appendChild(element);
                }
            });
        }
        
        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            console.log('ğŸ€„ æˆè¯­è¿è¿çœ‹é€»è¾‘æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            
            // è‡ªåŠ¨è¿è¡Œæ•°æ®ç»“æ„æµ‹è¯•
            setTimeout(() => {
                testDataStructure();
            }, 500);
        };
    </script>
</body>
</html> 