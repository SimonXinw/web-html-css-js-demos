<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æˆè¯­è¿è¿çœ‹ - æµ‹è¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f0f0f0;
        }
        .test-section {
            background: white;
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .status {
            padding: 10px;
            margin: 5px 0;
            border-radius: 4px;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>ğŸ€„ æˆè¯­è¿è¿çœ‹ - æ¸¸æˆæµ‹è¯•é¡µé¢</h1>
    
    <div class="test-section">
        <h2>1. DOMå…ƒç´ æ£€æŸ¥</h2>
        <button class="test-button" onclick="testDOMElements()">æ£€æŸ¥DOMå…ƒç´ </button>
        <div id="domTestResult"></div>
    </div>
    
    <div class="test-section">
        <h2>2. æ•°æ®æ–‡ä»¶æ£€æŸ¥</h2>
        <button class="test-button" onclick="testDataFiles()">æ£€æŸ¥æ•°æ®æ–‡ä»¶</button>
        <div id="dataTestResult"></div>
    </div>
    
    <div class="test-section">
        <h2>3. æ¸¸æˆåˆå§‹åŒ–æµ‹è¯•</h2>
        <button class="test-button" onclick="testGameInit()">åˆå§‹åŒ–æ¸¸æˆ</button>
        <div id="gameInitResult"></div>
    </div>
    
    <div class="test-section">
        <h2>4. åŠŸèƒ½æµ‹è¯•</h2>
        <button class="test-button" onclick="testGameFunctions()">æµ‹è¯•æ¸¸æˆåŠŸèƒ½</button>
        <div id="functionTestResult"></div>
    </div>
    
    <div class="test-section">
        <h2>5. å®Œæ•´æ¸¸æˆ</h2>
        <a href="index.html" class="test-button" style="text-decoration: none; display: inline-block;">æ‰“å¼€å®Œæ•´æ¸¸æˆ</a>
    </div>

    <script>
        // æµ‹è¯•DOMå…ƒç´ 
        function testDOMElements() {
            const result = document.getElementById('domTestResult');
            result.innerHTML = '';
            
            // åˆ›å»ºä¸€ä¸ªä¸´æ—¶iframeæ¥åŠ è½½ä¸»é¡µé¢
            const iframe = document.createElement('iframe');
            iframe.src = 'index.html';
            iframe.style.display = 'none';
            document.body.appendChild(iframe);
            
            iframe.onload = function() {
                const doc = iframe.contentDocument;
                const requiredElements = [
                    'gameStart', 'gameOver', 'levelComplete', 'mahjongArea', 
                    'startButton', 'restartButton', 'nextLevelButton', 'continueButton',
                    'levelValue', 'scoreValue', 'timeValue', 'idiomMeaning'
                ];
                
                let results = [];
                requiredElements.forEach(id => {
                    const element = doc.getElementById(id);
                    if (element) {
                        results.push(`<div class="status success">âœ… ${id}: æ‰¾åˆ°</div>`);
                    } else {
                        results.push(`<div class="status error">âŒ ${id}: æœªæ‰¾åˆ°</div>`);
                    }
                });
                
                result.innerHTML = results.join('');
                document.body.removeChild(iframe);
            };
        }
        
        // æµ‹è¯•æ•°æ®æ–‡ä»¶
        function testDataFiles() {
            const result = document.getElementById('dataTestResult');
            result.innerHTML = '<div class="status info">æ­£åœ¨æ£€æŸ¥æ•°æ®æ–‡ä»¶...</div>';
            
            // æ£€æŸ¥IdiomData.js
            const script = document.createElement('script');
            script.src = 'js/IdiomData.js';
            script.onload = function() {
                if (typeof IDIOM_DATA !== 'undefined' && typeof getLevelIdioms === 'function') {
                    const level1Data = getLevelIdioms(1);
                    const totalLevels = getTotalLevels();
                    
                    result.innerHTML = `
                        <div class="status success">âœ… IdiomData.js åŠ è½½æˆåŠŸ</div>
                        <div class="status info">ğŸ“Š æ€»å…³å¡æ•°: ${totalLevels}</div>
                        <div class="status info">ğŸ“ ç¬¬1å…³æˆè¯­æ•°: ${level1Data.length}</div>
                        <div class="status info">ğŸ¯ ç¬¬1ä¸ªæˆè¯­: ${level1Data[0].idiom}</div>
                    `;
                } else {
                    result.innerHTML = '<div class="status error">âŒ IdiomData.js æ•°æ®ä¸å®Œæ•´</div>';
                }
            };
            script.onerror = function() {
                result.innerHTML = '<div class="status error">âŒ æ— æ³•åŠ è½½ IdiomData.js</div>';
            };
            document.head.appendChild(script);
        }
        
        // æµ‹è¯•æ¸¸æˆåˆå§‹åŒ–
        function testGameInit() {
            const result = document.getElementById('gameInitResult');
            result.innerHTML = '<div class="status info">æ­£åœ¨æµ‹è¯•æ¸¸æˆåˆå§‹åŒ–...</div>';
            
            try {
                // åˆ›å»ºä¸´æ—¶çš„DOMå…ƒç´ ç”¨äºæµ‹è¯•
                const testContainer = document.createElement('div');
                testContainer.innerHTML = `
                    <div id="testGameStart"></div>
                    <div id="testGameOver"></div>
                    <div id="testLevelComplete"></div>
                    <div id="testMahjongArea"></div>
                    <button id="testStartButton"></button>
                `;
                testContainer.style.display = 'none';
                document.body.appendChild(testContainer);
                
                // æ¨¡æ‹Ÿæ¸¸æˆç±»ï¼ˆç®€åŒ–ç‰ˆï¼‰
                class TestGame {
                    constructor() {
                        this.gameStart = document.getElementById('testGameStart');
                        this.gameOver = document.getElementById('testGameOver');
                        this.levelComplete = document.getElementById('testLevelComplete');
                        this.mahjongArea = document.getElementById('testMahjongArea');
                        this.startButton = document.getElementById('testStartButton');
                        
                        if (this.gameStart && this.gameOver && this.levelComplete) {
                            return true;
                        } else {
                            throw new Error('DOMå…ƒç´ è·å–å¤±è´¥');
                        }
                    }
                }
                
                const testGame = new TestGame();
                result.innerHTML = '<div class="status success">âœ… æ¸¸æˆåˆå§‹åŒ–æµ‹è¯•é€šè¿‡</div>';
                
                // æ¸…ç†æµ‹è¯•å…ƒç´ 
                document.body.removeChild(testContainer);
                
            } catch (error) {
                result.innerHTML = `<div class="status error">âŒ æ¸¸æˆåˆå§‹åŒ–å¤±è´¥: ${error.message}</div>`;
            }
        }
        
        // æµ‹è¯•æ¸¸æˆåŠŸèƒ½
        function testGameFunctions() {
            const result = document.getElementById('functionTestResult');
            result.innerHTML = '<div class="status info">æ­£åœ¨æµ‹è¯•æ¸¸æˆåŠŸèƒ½...</div>';
            
            const tests = [];
            
            // æµ‹è¯•æˆè¯­æ•°æ®ç”Ÿæˆ
            try {
                if (typeof generateMahjongChars === 'function') {
                    const testIdioms = [{chars: ['ä¸€', 'å¿ƒ', 'ä¸€', 'æ„']}];
                    const chars = generateMahjongChars(testIdioms, 10);
                    if (chars.length === 10) {
                        tests.push('<div class="status success">âœ… éº»å°†ç‰Œç”ŸæˆåŠŸèƒ½æ­£å¸¸</div>');
                    } else {
                        tests.push('<div class="status error">âŒ éº»å°†ç‰Œç”Ÿæˆæ•°é‡é”™è¯¯</div>');
                    }
                } else {
                    tests.push('<div class="status error">âŒ generateMahjongChars å‡½æ•°æœªæ‰¾åˆ°</div>');
                }
            } catch (error) {
                tests.push(`<div class="status error">âŒ éº»å°†ç‰Œç”Ÿæˆæµ‹è¯•å¤±è´¥: ${error.message}</div>`);
            }
            
            // æµ‹è¯•å­—ç¬¦æ£€æŸ¥åŠŸèƒ½
            try {
                if (typeof getNextRequiredChar === 'function') {
                    const testIdiom = {chars: ['ä¸€', 'å¿ƒ', 'ä¸€', 'æ„']};
                    const selected = [false, false, false, false];
                    const next = getNextRequiredChar(testIdiom, selected);
                    if (next && next.char === 'ä¸€' && next.position === 0) {
                        tests.push('<div class="status success">âœ… å­—ç¬¦æ£€æŸ¥åŠŸèƒ½æ­£å¸¸</div>');
                    } else {
                        tests.push('<div class="status error">âŒ å­—ç¬¦æ£€æŸ¥åŠŸèƒ½å¼‚å¸¸</div>');
                    }
                } else {
                    tests.push('<div class="status error">âŒ getNextRequiredChar å‡½æ•°æœªæ‰¾åˆ°</div>');
                }
            } catch (error) {
                tests.push(`<div class="status error">âŒ å­—ç¬¦æ£€æŸ¥æµ‹è¯•å¤±è´¥: ${error.message}</div>`);
            }
            
            result.innerHTML = tests.join('');
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡ŒåŸºç¡€æµ‹è¯•
        window.onload = function() {
            console.log('æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
        };
    </script>
</body>
</html>