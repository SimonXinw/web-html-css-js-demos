<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PDFå‹ç¼©å·¥å…·</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    /* ä¸»å®¹å™¨ */
    .main-container {
      max-width: 100%;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
      overflow: hidden;
    }

    /* é¡¶éƒ¨æ§åˆ¶åŒºåŸŸ */
    .header-section {
      background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
      padding: 30px;
      color: white;
    }

    .header-title {
      font-size: 28px;
      font-weight: 600;
      margin-bottom: 20px;
      text-align: center;
    }

    .controls-container {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      align-items: center;
      justify-content: center;
    }

    .control-group {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 5px;
    }

    .control-group label {
      font-size: 14px;
      font-weight: 500;
    }

    .control-input {
      padding: 8px 12px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      min-width: 120px;
    }

    .control-input:focus {
      outline: none;
      background: white;
      box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.3);
    }

    .file-input-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
    }

    .file-input-button {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      padding: 12px 24px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 25px;
      cursor: pointer;
      font-size: 16px;
      font-weight: 500;
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }

    .file-input-button:hover {
      background: rgba(255, 255, 255, 0.3);
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    #fileInput {
      position: absolute;
      left: -9999px;
      opacity: 0;
    }

    .action-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 25px;
      font-size: 16px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-block;
      text-align: center;
    }

    .btn-primary {
      background: #ff6b6b;
      color: white;
    }

    .btn-secondary {
      background: rgba(255, 255, 255, 0.2);
      color: white;
      border: 2px solid rgba(255, 255, 255, 0.3);
    }

    .btn-success {
      background: #51cf66;
      color: white;
    }

    .btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none;
    }

    /* å†…å®¹åŒºåŸŸ */
    .content-section {
      padding: 30px;
    }

    /* çŠ¶æ€æ¶ˆæ¯ */
    #statusMessage {
      text-align: center;
      font-size: 16px;
      font-weight: 500;
      margin-bottom: 20px;
      padding: 15px;
      border-radius: 10px;
      background: #e3f2fd;
      color: #1976d2;
      border-left: 4px solid #2196f3;
    }

    /* è¿›åº¦æ¡ */
    .progress-container {
      width: 100%;
      background: #f0f0f0;
      border-radius: 10px;
      overflow: hidden;
      margin: 20px 0;
      display: none;
    }

    .progress-bar {
      height: 20px;
      background: linear-gradient(90deg, #ff6b6b, #ee5a24);
      width: 0%;
      transition: width 0.3s ease;
      border-radius: 10px;
      position: relative;
    }

    .progress-text {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 12px;
      font-weight: 500;
    }

    /* PDFæ–‡ä»¶æ˜¾ç¤º */
    #result {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .pdf-container {
      background: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      border: 1px solid #f0f0f0;
    }

    .pdf-container:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
    }

    .pdf-icon {
      width: 80px;
      height: 80px;
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      border-radius: 15px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto 15px;
      font-size: 32px;
      color: white;
    }

    .file-name {
      margin-top: 12px;
      font-size: 14px;
      font-weight: 500;
      color: #333;
      text-align: center;
      word-break: break-all;
    }

    .size-info {
      margin-top: 8px;
      font-size: 12px;
      text-align: center;
      font-weight: 500;
    }

    .individual-download {
      margin-top: 12px;
      display: block;
      text-align: center;
      padding: 8px 16px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      text-decoration: none;
      border-radius: 20px;
      font-size: 14px;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .individual-download:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    /* æ‹–æ‹½è¦†ç›–å±‚ */
    .drag-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(255, 107, 107, 0.9);
      backdrop-filter: blur(10px);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      font-size: 32px;
      color: white;
      font-weight: 600;
      text-align: center;
      border: 3px dashed #4fd1c5;
      box-sizing: border-box;
      margin: 20px;
      border-radius: 20px;
      animation: borderPulse 2s ease-in-out infinite;
    }

    .drag-overlay.show {
      display: flex;
    }

    .drag-overlay::before {
      content: "ğŸ“„ æ‹–æ‹½PDFæ–‡ä»¶åˆ°æ­¤å¤„å¼€å§‹å‹ç¼©";
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% {
        opacity: 1;
      }
      50% {
        opacity: 0.7;
      }
    }

    @keyframes borderPulse {
      0% {
        border-color: rgba(79, 209, 197, 0.3);
        box-shadow: 0 0 0 rgba(79, 209, 197, 0.3);
      }
      50% {
        border-color: rgba(79, 209, 197, 1);
        box-shadow: 0 0 20px rgba(79, 209, 197, 0.6);
      }
      100% {
        border-color: rgba(79, 209, 197, 0.3);
        box-shadow: 0 0 0 rgba(79, 209, 197, 0.3);
      }
    }

    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      .controls-container {
        justify-content: flex-start;
      }

      .btn,
      .file-input-button {
        padding: 10px 16px;
        font-size: 14px;
      }

      .control-input {
        min-width: inherit;
      }

      .action-buttons {
        width: 100%;
      }

      #result {
        grid-template-columns: 1fr;
      }

      .header-title {
        font-size: 24px;
      }
    }
  </style>
  <!-- åŠ è½½PDFå¤„ç†åº“å’Œæ–‡ä»¶ä¿å­˜åº“ -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.17.1/pdf-lib.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>

<body>
  <!-- æ‹–æ‹½è¦†ç›–å±‚ -->
  <div id="dragOverlay" class="drag-overlay"></div>

  <div class="main-container">
    <!-- é¡¶éƒ¨æ§åˆ¶åŒºåŸŸ -->
    <div class="header-section">
      <h1 class="header-title">ğŸ“„ æ™ºèƒ½PDFå‹ç¼©å·¥å…·</h1>

      <div class="controls-container">
        <!-- æ–‡ä»¶é€‰æ‹© -->
        <div class="control-group">
          <label>é€‰æ‹©PDFæ–‡ä»¶</label>
          <div class="file-input-wrapper">
            <div class="file-input-button" onclick="document.getElementById('fileInput').click()">
              ğŸ“ é€‰æ‹©æ–‡ä»¶
            </div>
            <input type="file" id="fileInput" accept=".pdf,application/pdf" multiple />
          </div>
        </div>

        <!-- å‹ç¼©çº§åˆ«é€‰æ‹© -->
        <div class="control-group">
          <label>å‹ç¼©çº§åˆ«</label>
          <select id="compressionLevel" class="control-input">
            <option value="low">è½»åº¦å‹ç¼©</option>
            <option value="medium" selected>ä¸­åº¦å‹ç¼©</option>
            <option value="high">é«˜åº¦å‹ç¼©</option>
          </select>
        </div>

        <!-- æ“ä½œæŒ‰é’® -->
        <div class="action-buttons">
          <button id="compressButton" class="btn btn-primary">
            ğŸš€ å¼€å§‹å‹ç¼©
          </button>
          <button id="clearButton" class="btn btn-secondary">
            ğŸ—‘ï¸ æ¸…é™¤æ–‡ä»¶
          </button>
          <a id="downloadButton" class="btn btn-success" style="display: none">ğŸ“¦ ä¸‹è½½å…¨éƒ¨</a>
        </div>
      </div>
    </div>

    <!-- å†…å®¹åŒºåŸŸ -->
    <div class="content-section">
      <!-- çŠ¶æ€æ¶ˆæ¯ -->
      <div id="statusMessage" style="display: none"></div>

      <!-- è¿›åº¦æ¡ -->
      <div id="progressContainer" class="progress-container">
        <div id="progressBar" class="progress-bar">
          <div id="progressText" class="progress-text">0%</div>
        </div>
      </div>

      <!-- å±•ç¤ºå‹ç¼©åçš„PDF -->
      <div id="result"></div>
    </div>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", function () {
      // è·å–å…ƒç´ çš„å¼•ç”¨
      const fileInput = document.getElementById("fileInput");
      const compressionLevel = document.getElementById("compressionLevel");
      const compressButton = document.getElementById("compressButton");
      const downloadButton = document.getElementById("downloadButton");
      const clearButton = document.getElementById("clearButton");
      const resultDiv = document.getElementById("result");
      const statusMessage = document.getElementById("statusMessage");
      const dragOverlay = document.getElementById("dragOverlay");
      const progressContainer = document.getElementById("progressContainer");
      const progressBar = document.getElementById("progressBar");
      const progressText = document.getElementById("progressText");

      let compressedPDFs = []; // å­˜å‚¨å‹ç¼©åçš„PDFæ•°æ®
      let compressionInProgress = false; // æ ‡è¯†å‹ç¼©çŠ¶æ€
      let isDragging = false; // æ‹–æ‹½çŠ¶æ€

      // ç›‘å¬æ–‡ä»¶é€‰æ‹©
      fileInput.addEventListener("change", handleFileSelect, false);

      // æ‹–æ‹½äº‹ä»¶å¤„ç†
      window.addEventListener("dragover", function (e) {
        e.preventDefault();
        if (!isDragging) {
          isDragging = true;
          dragOverlay.classList.add("show");
        }
      });

      window.addEventListener("dragleave", function (e) {
        e.preventDefault();
        if (
          e.clientX <= 0 ||
          e.clientY <= 0 ||
          e.clientX >= window.innerWidth ||
          e.clientY >= window.innerHeight
        ) {
          isDragging = false;
          dragOverlay.classList.remove("show");
        }
      });

      window.addEventListener("drop", function (e) {
        e.preventDefault();
        isDragging = false;
        dragOverlay.classList.remove("show");

        const files = e.dataTransfer.files;
        if (files.length > 0) {
          fileInput.files = files;
          handleFileSelect({ target: { files: files } });
          
          // è‡ªåŠ¨å¼€å§‹å‹ç¼©
          setTimeout(() => {
            compressPDFs();
          }, 100);
        }
      });

      // å‹ç¼©æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      compressButton.addEventListener("click", compressPDFs);

      // ä¸‹è½½æŒ‰é’®ç‚¹å‡»äº‹ä»¶
      downloadButton.addEventListener("click", function () {
        if (!compressionInProgress && compressedPDFs.length > 0) {
          if (compressedPDFs.length === 1) {
            downloadPDF(compressedPDFs[0].blob, compressedPDFs[0].fileName);
          } else {
            downloadAllPDFs();
          }
        }
      });

      // æ¸…é™¤æŒ‰é’®äº‹ä»¶å¤„ç†
      clearButton.addEventListener("click", function () {
        resetCompressionState();
        fileInput.value = "";
        statusMessage.style.display = "none";
        progressContainer.style.display = "none";
      });

      /**
       * å‹ç¼©PDFæ–‡ä»¶çš„ä¸»è¦å‡½æ•°
       */
      async function compressPDFs() {
        const files = fileInput.files;
        if (files.length === 0) {
          showMessage("è¯·å…ˆé€‰æ‹©PDFæ–‡ä»¶ã€‚", "error");
          return;
        }

        if (compressionInProgress) {
          showMessage("å‹ç¼©æ­£åœ¨è¿›è¡Œä¸­ï¼Œè¯·ç¨å€™...", "warning");
          return;
        }

        // é‡ç½®çŠ¶æ€
        resetCompressionState();
        compressionInProgress = true;
        compressButton.disabled = true;

        // æ˜¾ç¤ºè¿›åº¦æ¡
        progressContainer.style.display = "block";
        showMessage("ğŸ”„ PDFå‹ç¼©ä¸­...", "info");

        try {
          const level = compressionLevel.value;
          let completedFiles = 0;

          for (let i = 0; i < files.length; i++) {
            const file = files[i];
            updateProgress((i / files.length) * 100, `æ­£åœ¨å‹ç¼©: ${file.name}`);

            try {
              const compressedData = await compressSinglePDF(file, level);
              compressedPDFs.push(compressedData);
              displayPDF(compressedData);
              completedFiles++;
            } catch (error) {
              console.error(`å‹ç¼©æ–‡ä»¶ ${file.name} å¤±è´¥:`, error);
              showMessage(`âŒ å‹ç¼©æ–‡ä»¶ ${file.name} å¤±è´¥: ${error.message}`, "error");
            }

            updateProgress(((i + 1) / files.length) * 100, `å·²å®Œæˆ: ${i + 1}/${files.length}`);
          }

          if (completedFiles > 0) {
            showMessage(`âœ… æˆåŠŸå‹ç¼© ${completedFiles} ä¸ªPDFæ–‡ä»¶ï¼`, "success");
            downloadButton.style.display = "block";
            
            // å¦‚æœåªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œè‡ªåŠ¨ä¸‹è½½
            if (completedFiles === 1) {
              setTimeout(() => {
                downloadPDF(compressedPDFs[0].blob, compressedPDFs[0].fileName);
              }, 1000);
            }
          } else {
            showMessage("âŒ æ²¡æœ‰æ–‡ä»¶è¢«æˆåŠŸå‹ç¼©", "error");
          }

        } catch (error) {
          console.error("å‹ç¼©è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯:", error);
          showMessage("âŒ å‹ç¼©è¿‡ç¨‹ä¸­å‡ºç°é”™è¯¯", "error");
        } finally {
          compressionInProgress = false;
          compressButton.disabled = false;
          progressContainer.style.display = "none";
        }
      }

      /**
       * å‹ç¼©å•ä¸ªPDFæ–‡ä»¶
       * @param {File} file - è¦å‹ç¼©çš„PDFæ–‡ä»¶
       * @param {string} level - å‹ç¼©çº§åˆ«
       * @returns {Promise} å‹ç¼©ç»“æœ
       */
      async function compressSinglePDF(file, level) {
        const arrayBuffer = await file.arrayBuffer();
        const pdfDoc = await PDFLib.PDFDocument.load(arrayBuffer);

        // æ ¹æ®å‹ç¼©çº§åˆ«è®¾ç½®å‚æ•°
        const compressionSettings = {
          low: { imageQuality: 0.8, removeMetadata: false },
          medium: { imageQuality: 0.6, removeMetadata: true },
          high: { imageQuality: 0.4, removeMetadata: true }
        };

        const settings = compressionSettings[level];

        // ç§»é™¤å…ƒæ•°æ®ï¼ˆå¦‚æœè®¾ç½®äº†çš„è¯ï¼‰
        if (settings.removeMetadata) {
          try {
            pdfDoc.setTitle('');
            pdfDoc.setAuthor('');
            pdfDoc.setSubject('');
            pdfDoc.setKeywords([]);
            pdfDoc.setProducer('');
            pdfDoc.setCreator('');
          } catch (e) {
            // å¿½ç•¥å…ƒæ•°æ®ç§»é™¤é”™è¯¯
          }
        }

        // ç”Ÿæˆå‹ç¼©åçš„PDF
        const pdfBytes = await pdfDoc.save({
          useObjectStreams: true,
          addDefaultPage: false,
          objectsPerTick: 50,
        });

        const originalSize = file.size;
        const compressedSize = pdfBytes.length;
        const compressionRatio = ((originalSize - compressedSize) / originalSize * 100).toFixed(1);

        const blob = new Blob([pdfBytes], { type: 'application/pdf' });
        const fileName = generateFileName(file.name);

        return {
          blob,
          fileName,
          originalSize,
          compressedSize,
          compressionRatio,
          pageCount: pdfDoc.getPageCount()
        };
      }

      /**
       * ç”Ÿæˆæ–°çš„æ–‡ä»¶å
       * @param {string} originalName - åŸå§‹æ–‡ä»¶å
       * @returns {string} æ–°æ–‡ä»¶å
       */
      function generateFileName(originalName) {
        const nameWithoutExt = originalName.replace(/\.pdf$/i, '');
        return `${nameWithoutExt}_compressed.pdf`;
      }

      /**
       * æ˜¾ç¤ºå‹ç¼©åçš„PDFä¿¡æ¯
       * @param {Object} pdfData - PDFæ•°æ®å¯¹è±¡
       */
      function displayPDF(pdfData) {
        const container = document.createElement("div");
        container.classList.add("pdf-container");

        // PDFå›¾æ ‡
        const pdfIcon = document.createElement("div");
        pdfIcon.classList.add("pdf-icon");
        pdfIcon.textContent = "ğŸ“„";

        // æ–‡ä»¶åæ ‡ç­¾
        const fileNameLabel = document.createElement("div");
        fileNameLabel.classList.add("file-name");
        fileNameLabel.textContent = pdfData.fileName;

        // é¡µæ•°ä¿¡æ¯
        const pageInfo = document.createElement("div");
        pageInfo.style.marginTop = "8px";
        pageInfo.style.fontSize = "12px";
        pageInfo.style.textAlign = "center";
        pageInfo.style.color = "#666";
        pageInfo.style.fontWeight = "500";
        pageInfo.textContent = `${pdfData.pageCount} é¡µ`;

        // æ–‡ä»¶å¤§å°ä¿¡æ¯
        const sizeInfo = document.createElement("div");
        sizeInfo.classList.add("size-info");

        const originalSizeText = document.createElement("span");
        originalSizeText.style.color = "black";
        originalSizeText.textContent = `${formatFileSize(pdfData.originalSize)} `;

        const separator = document.createElement("span");
        separator.textContent = "â†’ ";
        separator.style.color = "#666";

        const compressedSizeText = document.createElement("span");
        compressedSizeText.style.color = "green";
        compressedSizeText.textContent = `${formatFileSize(pdfData.compressedSize)}`;

        const ratioText = document.createElement("span");
        ratioText.style.color = pdfData.compressionRatio > 0 ? "green" : "red";
        ratioText.style.marginLeft = "8px";
        ratioText.style.fontSize = "11px";
        ratioText.textContent = `(${pdfData.compressionRatio > 0 ? "-" : "+"}${Math.abs(pdfData.compressionRatio)}%)`;

        sizeInfo.appendChild(originalSizeText);
        sizeInfo.appendChild(separator);
        sizeInfo.appendChild(compressedSizeText);
        sizeInfo.appendChild(ratioText);

        // å•ç‹¬ä¸‹è½½æŒ‰é’®
        const individualDownloadButton = document.createElement("a");
        individualDownloadButton.classList.add("individual-download");
        individualDownloadButton.textContent = "ğŸ“¥ ä¸‹è½½";
        individualDownloadButton.href = "#";
        individualDownloadButton.onclick = function (e) {
          e.preventDefault();
          downloadPDF(pdfData.blob, pdfData.fileName);
        };

        // ç»„è£…å®¹å™¨
        container.appendChild(pdfIcon);
        container.appendChild(fileNameLabel);
        container.appendChild(pageInfo);
        container.appendChild(sizeInfo);
        container.appendChild(individualDownloadButton);
        resultDiv.appendChild(container);
      }

      /**
       * ä¸‹è½½å•ä¸ªPDFæ–‡ä»¶
       * @param {Blob} blob - PDFæ–‡ä»¶blob
       * @param {string} fileName - æ–‡ä»¶å
       */
      function downloadPDF(blob, fileName) {
        try {
          saveAs(blob, fileName);
          showMessage(`ğŸ“¥ ${fileName} ä¸‹è½½å®Œæˆï¼`, "success");
        } catch (error) {
          console.error("ä¸‹è½½å¤±è´¥:", error);
          showMessage("âŒ ä¸‹è½½å¤±è´¥", "error");
        }
      }

      /**
       * ä¸‹è½½æ‰€æœ‰å‹ç¼©åçš„PDFæ–‡ä»¶ï¼ˆæ‰“åŒ…ä¸ºZIPï¼‰
       */
      async function downloadAllPDFs() {
        if (compressedPDFs.length === 0) {
          showMessage("æ²¡æœ‰å¯ä¸‹è½½çš„æ–‡ä»¶", "warning");
          return;
        }

        try {
          // å¦‚æœåªæœ‰ä¸€ä¸ªæ–‡ä»¶ï¼Œç›´æ¥ä¸‹è½½
          if (compressedPDFs.length === 1) {
            downloadPDF(compressedPDFs[0].blob, compressedPDFs[0].fileName);
            return;
          }

          // å¤šä¸ªæ–‡ä»¶æ—¶ï¼Œåˆ›å»ºZIPåŒ…
          const JSZip = window.JSZip;
          if (!JSZip) {
            showMessage("âŒ ZIPåº“æœªåŠ è½½ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•", "error");
            return;
          }

          const zip = new JSZip();
          const timestamp = new Date().toISOString().slice(0, 19).replace(/:/g, "-");

          // å°†æ¯ä¸ªPDFæ–‡ä»¶æ·»åŠ åˆ°ZIP
          for (const pdfData of compressedPDFs) {
            const arrayBuffer = await pdfData.blob.arrayBuffer();
            zip.file(pdfData.fileName, arrayBuffer);
          }

          showMessage("ğŸ“¦ æ­£åœ¨æ‰“åŒ…ä¸‹è½½æ–‡ä»¶...", "info");
          const content = await zip.generateAsync({ type: "blob" });
          saveAs(content, `compressed-pdfs-${timestamp}.zip`);
          showMessage("âœ… ä¸‹è½½å®Œæˆï¼", "success");

        } catch (error) {
          console.error("æ‰“åŒ…ä¸‹è½½å¤±è´¥:", error);
          showMessage("âŒ æ‰“åŒ…ä¸‹è½½å¤±è´¥", "error");
        }
      }

      /**
       * æ›´æ–°è¿›åº¦æ¡
       * @param {number} percentage - è¿›åº¦ç™¾åˆ†æ¯”
       * @param {string} text - è¿›åº¦æ–‡æœ¬
       */
      function updateProgress(percentage, text) {
        progressBar.style.width = percentage + "%";
        progressText.textContent = Math.round(percentage) + "%";
        if (text) {
          showMessage(text, "info");
        }
      }

      /**
       * é‡ç½®å‹ç¼©çŠ¶æ€
       */
      function resetCompressionState() {
        compressedPDFs = [];
        resultDiv.innerHTML = "";
        downloadButton.style.display = "none";
        progressBar.style.width = "0%";
        progressText.textContent = "0%";
      }

      /**
       * æ˜¾ç¤ºçŠ¶æ€æ¶ˆæ¯
       * @param {string} message - æ¶ˆæ¯å†…å®¹
       * @param {string} type - æ¶ˆæ¯ç±»å‹
       */
      function showMessage(message, type = "info") {
        statusMessage.style.display = "block";
        statusMessage.textContent = message;

        const colors = {
          info: { bg: "#e3f2fd", color: "#1976d2", border: "#2196f3" },
          success: { bg: "#e8f5e8", color: "#2e7d32", border: "#4caf50" },
          error: { bg: "#ffebee", color: "#c62828", border: "#f44336" },
          warning: { bg: "#fff3e0", color: "#ef6c00", border: "#ff9800" },
        };

        const style = colors[type] || colors.info;
        statusMessage.style.background = style.bg;
        statusMessage.style.color = style.color;
        statusMessage.style.borderLeftColor = style.border;
      }

      /**
       * æ ¼å¼åŒ–æ–‡ä»¶å¤§å°æ˜¾ç¤º
       * @param {number} bytes - æ–‡ä»¶å¤§å°ï¼ˆå­—èŠ‚ï¼‰
       * @returns {string} æ ¼å¼åŒ–åçš„æ–‡ä»¶å¤§å°å­—ç¬¦ä¸²
       */
      function formatFileSize(bytes) {
        if (bytes === 0) return "0 B";
        const k = 1024;
        const sizes = ["B", "KB", "MB", "GB"];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
      }

      /**
       * å¤„ç†æ–‡ä»¶é€‰æ‹©äº‹ä»¶
       * @param {Event} event - æ–‡ä»¶é€‰æ‹©äº‹ä»¶
       */
      function handleFileSelect(event) {
        const files = event.target.files;

        if (!files.length) {
          return;
        }

        // éªŒè¯æ–‡ä»¶ç±»å‹
        const invalidFiles = Array.from(files).filter(
          (file) => !file.type.match("application/pdf") && !file.name.toLowerCase().endsWith('.pdf')
        );
        
        if (invalidFiles.length > 0) {
          showMessage(
            `âŒ æ£€æµ‹åˆ° ${invalidFiles.length} ä¸ªéPDFæ–‡ä»¶ï¼Œè¯·åªé€‰æ‹©PDFæ–‡ä»¶ã€‚`,
            "error"
          );
          return;
        }

        downloadButton.style.display = "none";
        showMessage(`ğŸ“ å·²é€‰æ‹© ${files.length} ä¸ªPDFæ–‡ä»¶`, "info");
      }
    });
  </script>
</body>

</html>
