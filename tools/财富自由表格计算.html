<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ë¥¢ÂØåËá™Áî±ÊåáÂçóË°®Ê†ºËÆ°ÁÆó</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, "Microsoft YaHei", sans-serif;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            overflow-x: auto;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        .input_section {
            margin-bottom: 20px;
        }

        .basic_inputs {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            align-items: center;
            justify-content: center;
        }

        .income_config_section {
            background-color: #f9f9f9;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 15px;
            border: 1px solid #e0e0e0;
        }

        .income_config_title {
            font-size: 16px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .income_segments {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .income_segment {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
            background-color: white;
            padding: 10px;
            border-radius: 6px;
            border: 1px solid #ddd;
        }

        .segment_label {
            color: #666;
            font-size: 14px;
            white-space: nowrap;
        }

        .segment_year_range {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .segment_year_input {
            width: 70px;
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .segment_income_input {
            width: 120px;
            padding: 6px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }

        .input_group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .input_group label {
            font-weight: bold;
            color: #555;
        }

        .input_group input {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            width: 150px;
        }

        .input_group input:focus,
        .segment_year_input:focus,
        .segment_income_input:focus {
            outline: none;
            border-color: #4CAF50;
        }

        .segment_hint {
            color: #999;
            font-size: 12px;
            font-style: italic;
        }

        .table_wrapper {
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 20px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
            min-width: 800px;
        }

        th,
        td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: center;
            min-width: 80px;
            white-space: nowrap;
        }

        th {
            background-color: #FFE599;
            font-weight: bold;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td:first-child,
        th:first-child {
            background-color: #B4C7E7;
            font-weight: bold;
            position: sticky;
            left: 0;
            z-index: 5;
        }

        th:first-child {
            z-index: 15;
        }

        .result_cell {
            font-weight: 500;
        }

        .result_cell.forever {
            background-color: #C6E0B4;
            color: #2E7D32;
        }

        .result_cell.years_1_5 {
            background-color: #FF6B6B;
            color: white;
        }

        .result_cell.years_6_10 {
            background-color: #FFA500;
            color: white;
        }

        .result_cell.years_11_30 {
            background-color: #FFD966;
            color: #333;
        }

        .result_cell.years_31_plus {
            background-color: #9BC2E6;
            color: #333;
        }

        .description_section {
            margin-top: 30px;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .description_title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }

        .description_content {
            color: #555;
            line-height: 1.8;
        }

        .description_content h3 {
            font-size: 16px;
            color: #333;
            margin-top: 20px;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .description_content h3:first-child {
            margin-top: 0;
        }

        .description_content p {
            margin-bottom: 12px;
        }

        .description_content ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .description_content li {
            margin-bottom: 8px;
        }

        .description_content code {
            background-color: #fff;
            padding: 2px 6px;
            border-radius: 3px;
            color: #e91e63;
            font-family: "Courier New", monospace;
            border: 1px solid #e0e0e0;
        }

        .formula_box {
            background-color: #fff;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #4CAF50;
            margin: 15px 0;
            font-family: "Courier New", monospace;
        }

        .color_legend {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 15px 0;
        }

        .color_item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color_box {
            width: 30px;
            height: 20px;
            border-radius: 3px;
            border: 1px solid #ddd;
        }

        .color_box.forever {
            background-color: #C6E0B4;
        }

        .color_box.years_1_5 {
            background-color: #FF6B6B;
        }

        .color_box.years_6_10 {
            background-color: #FFA500;
        }

        .color_box.years_11_30 {
            background-color: #FFD966;
        }

        .color_box.years_31_plus {
            background-color: #9BC2E6;
        }

        @media (max-width: 768px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 15px;
            }

            h1 {
                font-size: 18px;
                margin-bottom: 15px;
            }

            .basic_inputs {
                flex-direction: column;
            }

            .income_segment {
                flex-direction: column;
                align-items: flex-start;
            }

            .income_config_section {
                padding: 10px;
            }

            .income_config_title {
                font-size: 14px;
            }

            table {
                font-size: 10px;
                min-width: 600px;
            }

            th,
            td {
                padding: 5px;
                min-width: 50px;
            }

            .description_section {
                padding: 15px;
                margin-top: 20px;
            }

            .description_title {
                font-size: 16px;
            }

            .description_content {
                font-size: 14px;
            }

            .description_content h3 {
                font-size: 15px;
            }

            .color_legend {
                gap: 10px;
            }

            .formula_box {
                padding: 10px;
                font-size: 12px;
                overflow-x: auto;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>Ë¥¢ÂØåËá™Áî±ÊåáÂçó - Êú¨ÈáëÔºàÂπ¥Âà©Áéá <span id="rate_display">2.0</span>%Ôºâ</h1>

        <div class="input_section">
            <div class="basic_inputs">
                <div class="input_group">
                    <label for="annual_rate">Âπ¥Âà©ÁéáÔºà%ÔºâÔºö</label>
                    <input type="number" id="annual_rate" value="2.0" step="0.1" min="0" max="100">
                </div>
                <div class="input_group">
                    <label for="max_years">ËÆ°ÁÆóÂπ¥‰ªΩÔºö</label>
                    <input type="number" id="max_years" value="50" step="1" min="10" max="200">
                </div>
            </div>

            <div class="income_config_section">
                <div class="income_config_title">üí∞ ÂàÜÊÆµÊî∂ÂÖ•ÈÖçÁΩÆÔºàÊúÄÂ§ö<span id="max_years_display">50</span>Âπ¥Ôºâ</div>
                <div id="income_segments" class="income_segments">
                    <!-- Êî∂ÂÖ•ÊÆµÂ∞ÜÂä®ÊÄÅÁîüÊàê -->
                </div>
            </div>
        </div>

        <div class="table_wrapper">
            <table id="wealth_table">
                <!-- Ë°®Ê†ºÂÜÖÂÆπÂ∞ÜÈÄöËøá JavaScript Âä®ÊÄÅÁîüÊàê -->
            </table>
        </div>

        <div class="description_section">
            <div class="description_title">üìä ËÆ°ÁÆóÈÄªËæëËØ¥Êòé</div>
            <div class="description_content">
                <h3>üí° Â∑•ÂÖ∑Áî®ÈÄî</h3>
                <p>Ëøô‰∏™Â∑•ÂÖ∑Â∏ÆÂä©‰Ω†ËÆ°ÁÆóÂú®‰∏çÂêåÊú¨Èáë„ÄÅÊ∂àË¥πÊ∞¥Âπ≥ÂíåÊî∂ÂÖ•Êù°‰ª∂‰∏ãÔºå‰Ω†ÁöÑËµÑ‰∫ßËÉΩÂ§üÁª¥ÊåÅÂ§öÂ∞ëÂπ¥Ôºå‰ªéËÄåËßÑÂàíË¥¢ÂØåËá™Áî±‰πãË∑Ø„ÄÇ</p>

                <h3>üßÆ Ê†∏ÂøÉËÆ°ÁÆóÂÖ¨Âºè</h3>
                <div class="formula_box">
                    <strong>Á¨¨NÂπ¥Âπ¥Â∫ïÊú¨Èáë = (Á¨¨NÂπ¥Âπ¥ÂàùÊú¨Èáë + Á¨¨NÂπ¥Êî∂ÂÖ• - Á¨¨NÂπ¥Ê∂àË¥π) √ó (1 + Âπ¥Âà©Áéá)</strong>
                </div>
                <p>ËÆ°ÁÆóËøáÁ®ãÔºö</p>
                <ul>
                    <li><strong>Âπ¥ÂàùÊú¨ÈáëÔºö</strong>‰∏ä‰∏ÄÂπ¥Âπ¥Â∫ïÂâ©‰ΩôÁöÑÊú¨Èáë</li>
                    <li><strong>Á¨¨NÂπ¥Êî∂ÂÖ•Ôºö</strong>Ê†πÊçÆÂàÜÊÆµÈÖçÁΩÆËé∑ÂèñËØ•Âπ¥ÁöÑÊî∂ÂÖ•ÈáëÈ¢ù</li>
                    <li><strong>Á¨¨NÂπ¥Ê∂àË¥πÔºö</strong>Ë°®Ê†ºÁ¨¨‰∏ÄÂàóÂØπÂ∫îÁöÑÊØèÂπ¥Ê∂àË¥πÈáëÈ¢ù</li>
                    <li><strong>Âπ¥Âà©ÁéáÔºö</strong>È°µÈù¢È°∂ÈÉ®ËæìÂÖ•ÁöÑÂπ¥Âà©ÁéáÔºàÂ¶Ç2%Ë°®Á§∫0.02Ôºâ</li>
                </ul>

                <h3>üîÑ ËÆ°ÁÆóÊµÅÁ®ã</h3>
                <p>ÂØπ‰∫éÊØè‰∏™Êú¨ÈáëÂíåÊ∂àË¥πÁªÑÂêàÔºåÁ≥ªÁªü‰ºöËøõË°å‰ª•‰∏ãËÆ°ÁÆóÔºö</p>
                <ul>
                    <li><strong>Á¨¨1Ê≠•Ôºö</strong>ËÆ°ÁÆóÁ¨¨1Âπ¥Âπ¥ÂàùÂèØÁî®ÈáëÈ¢ù = ÂàùÂßãÊú¨Èáë + Á¨¨1Âπ¥Êî∂ÂÖ• - Á¨¨1Âπ¥Ê∂àË¥π</li>
                    <li><strong>Á¨¨2Ê≠•Ôºö</strong>Â¶ÇÊûúÂèØÁî®ÈáëÈ¢ù ‚â• ÂàùÂßãÊú¨ÈáëÔºåÂà§ÂÆö‰∏∫"Ê∞∏ËøúËä±‰∏çÂÆå"ÔºàÈí±Ë∂äÊù•Ë∂äÂ§öÔºâ</li>
                    <li><strong>Á¨¨3Ê≠•Ôºö</strong>Â¶ÇÊûúÂèØÁî®ÈáëÈ¢ù ‚â§ 0ÔºåËÆ∞ÂΩï‰∏∫"Á¨¨1Âπ¥Ëä±ÂÆå"</li>
                    <li><strong>Á¨¨4Ê≠•Ôºö</strong>Âê¶ÂàôÔºåËÆ°ÁÆóÂπ¥Â∫ïÊú¨Èáë = ÂèØÁî®ÈáëÈ¢ù √ó (1 + Âπ¥Âà©Áéá)</li>
                    <li><strong>Á¨¨5Ê≠•Ôºö</strong>ËøõÂÖ•Á¨¨2Âπ¥ÔºåÈáçÂ§ç‰ª•‰∏äÊ≠•È™§ÔºåÁõ¥Âà∞Èí±Ëä±ÂÆåÊàñË∂ÖËøá1000Âπ¥</li>
                </ul>

                <h3>üí∞ ÂàÜÊÆµÊî∂ÂÖ•ÈÖçÁΩÆ</h3>
                <p>ÊîØÊåÅ‰∏∫‰∏çÂêåÂπ¥‰ªΩÊÆµËÆæÁΩÆ‰∏çÂêåÁöÑÊî∂ÂÖ•ÔºåÊ®°ÊãüÁúüÂÆûÁöÑ‰∫∫ÁîüË¥¢Âä°ËßÑÂàíÔºö</p>
                <ul>
                    <li><strong>Â∑•‰ΩúÊúüÔºö</strong>‰æãÂ¶Ç1-30Âπ¥ÔºåÊØèÂπ¥ÊúâÁ®≥ÂÆöÊî∂ÂÖ•</li>
                    <li><strong>ÈÄÄ‰ºëÊúüÔºö</strong>‰æãÂ¶Ç31-50Âπ¥ÔºåÊî∂ÂÖ•Èôç‰ΩéÊàñ‰∏∫0</li>
                    <li>ÂèØÊ∑ªÂä†Â§ö‰∏™Êó∂Èó¥ÊÆµÔºåÊúÄÂ§öÈÖçÁΩÆÂà∞Á¨¨50Âπ¥</li>
                </ul>

                <h3>üé® ÁªìÊûúÈ¢úËâ≤ËØ¥Êòé</h3>
                <div class="color_legend">
                    <div class="color_item">
                        <div class="color_box years_1_5"></div>
                        <span>1-5Âπ¥Ëä±ÂÆåÔºàÁ∫¢Ëâ≤Ôºâ- È£éÈô©ÊûÅÈ´ò</span>
                    </div>
                    <div class="color_item">
                        <div class="color_box years_6_10"></div>
                        <span>6-10Âπ¥Ëä±ÂÆåÔºàÊ©ôËâ≤Ôºâ- È£éÈô©ËæÉÈ´ò</span>
                    </div>
                    <div class="color_item">
                        <div class="color_box years_11_30"></div>
                        <span>11-30Âπ¥Ëä±ÂÆåÔºàÈªÑËâ≤Ôºâ- ‰∏≠Á≠âÈ£éÈô©</span>
                    </div>
                    <div class="color_item">
                        <div class="color_box years_31_plus"></div>
                        <span>31Âπ¥‰ª•‰∏äËä±ÂÆåÔºàËìùËâ≤Ôºâ- Áõ∏ÂØπÂÆâÂÖ®</span>
                    </div>
                    <div class="color_item">
                        <div class="color_box forever"></div>
                        <span>Ê∞∏ËøúËä±‰∏çÂÆåÔºàÁªøËâ≤Ôºâ- Ë¥¢ÂØåËá™Áî±</span>
                    </div>
                </div>

                <h3>üìù ‰ΩøÁî®Á§∫‰æã</h3>
                <p><strong>Âú∫ÊôØÔºö</strong>Êú¨Èáë100‰∏áÔºåÊØèÂπ¥Ê∂àË¥π10‰∏áÔºåÂπ¥Âà©Áéá2%ÔºåÂâç30Âπ¥ÊØèÂπ¥Êî∂ÂÖ•20‰∏á</p>
                <ul>
                    <li><strong>Á¨¨1Âπ¥ÂàùÔºö</strong>ÂèØÁî® = 100 + 20 - 10 = 110‰∏á ‚â• 100‰∏á ‚Üí Âà§ÂÆö‰∏∫"Ê∞∏ËøúËä±‰∏çÂÆå"</li>
                </ul>
                <p><strong>Âú∫ÊôØÔºö</strong>Êú¨Èáë100‰∏áÔºåÊØèÂπ¥Ê∂àË¥π20‰∏áÔºåÂπ¥Âà©Áéá2%ÔºåÊó†Êî∂ÂÖ•</p>
                <ul>
                    <li><strong>Á¨¨1Âπ¥ÂàùÔºö</strong>ÂèØÁî® = 100 + 0 - 20 = 80‰∏á</li>
                    <li><strong>Á¨¨1Âπ¥Â∫ïÔºö</strong>Êú¨Èáë = 80 √ó 1.02 = 81.6‰∏á</li>
                    <li><strong>Á¨¨2Âπ¥ÂàùÔºö</strong>ÂèØÁî® = 81.6 + 0 - 20 = 61.6‰∏á</li>
                    <li><strong>Á¨¨2Âπ¥Â∫ïÔºö</strong>Êú¨Èáë = 61.6 √ó 1.02 = 62.832‰∏á</li>
                    <li>...‰ª•Ê≠§Á±ªÊé®ÔºåÁõ¥Âà∞ÊüêÂπ¥ÂèØÁî®ÈáëÈ¢ù ‚â§ 0</li>
                </ul>

                <h3>‚ö†Ô∏è Ê≥®ÊÑè‰∫ãÈ°π</h3>
                <ul>
                    <li>ËÆ°ÁÆóÁªìÊûúÂü∫‰∫éÁêÜÊÉ≥ÂåñÂÅáËÆæÔºå‰∏çËÄÉËôëÈÄöË¥ßËÜ®ËÉÄ„ÄÅÁ®éÊî∂„ÄÅÂåªÁñóÁ≠âÈ¢ùÂ§ñÊîØÂá∫</li>
                    <li>Âπ¥Âà©ÁéáÂ∫îÊ†πÊçÆÂÆûÈôÖÊäïËµÑÊî∂ÁõäÁéáËÆæÁΩÆÔºàÂ¶ÇÂõΩÂÄ∫2%„ÄÅÁêÜË¥¢4%„ÄÅËÇ°Á•®8%Á≠âÔºâ</li>
                    <li>Âª∫ËÆÆÂú®ÂÆûÈôÖËßÑÂàíÊó∂È¢ÑÁïô‰∏ÄÂÆöÁöÑÂÆâÂÖ®ËæπÈôÖ</li>
                    <li>Êú¨Â∑•ÂÖ∑‰ªÖ‰æõÂèÇËÄÉÔºå‰∏çÊûÑÊàêÊäïËµÑÂª∫ËÆÆ</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        // Á¨¨‰∏ÄË°åÔºöÊú¨ÈáëÊï∞ÊçÆÔºà‰∏áÂÖÉÔºâ
        const PRINCIPAL_AMOUNTS = [10, 20, 30, 50, 100, 150, 200, 300, 500, 1000, 2000, 5000, 10000];

        // Á¨¨‰∏ÄÂàóÔºöÊØèÂπ¥Ê∂àË¥πÊï∞ÊçÆÔºà‰∏áÂÖÉÔºâ
        const ANNUAL_EXPENSES = [2, 3.5, 5, 10, 20, 30, 50, 75, 100, 150, 200, 250, 300, 500];

        // ÈªòËÆ§ÈÖçÁΩÆ
        const DEFAULT_RATE = 2.0;
        const DEFAULT_MAX_YEARS = 50;
        let MAX_YEARS = DEFAULT_MAX_YEARS;

        // Êî∂ÂÖ•ÊÆµÈÖçÁΩÆÊï∞ÁªÑ
        let incomeSegments = [
            { startYear: 1, endYear: DEFAULT_MAX_YEARS, income: 0 }
        ];

        /**
         * Ê†ºÂºèÂåñÊú¨ÈáëÊòæÁ§∫
         * @param {number} amount - ÈáëÈ¢ùÔºà‰∏áÂÖÉÔºâ
         * @returns {string} Ê†ºÂºèÂåñÂêéÁöÑÂ≠óÁ¨¶‰∏≤
         */
        const formatPrincipal = (amount) => {
            if (amount >= 10000) {
                return `${amount / 10000}‰∫øÂÖÉ`;
            }
            return `${amount}‰∏á`;
        };

        /**
         * Ê†πÊçÆÂπ¥‰ªΩËé∑ÂèñÂØπÂ∫îÁöÑÊî∂ÂÖ•
         * @param {number} year - Âπ¥‰ªΩ
         * @returns {number} ËØ•Âπ¥‰ªΩÁöÑÊî∂ÂÖ•Ôºà‰∏áÂÖÉÔºâ
         */
        const getIncomeByYear = (year) => {
            for (const segment of incomeSegments) {
                if (year >= segment.startYear && year <= segment.endYear) {
                    return segment.income;
                }
            }
            return 0;
        };

        /**
         * ËÆ°ÁÆóÂú®ÁªôÂÆöÊù°‰ª∂‰∏ãËÉΩÊ∂àË¥πÂ§öÂ∞ëÂπ¥
         * @param {number} initialPrincipal - ÂàùÂßãÊú¨ÈáëÔºà‰∏áÂÖÉÔºâ
         * @param {number} annualExpense - ÊØèÂπ¥Ê∂àË¥πÔºà‰∏áÂÖÉÔºâ
         * @param {number} annualRate - Âπ¥Âà©ÁéáÔºàÁôæÂàÜÊØîÔºâ
         * @returns {number|string} ÂèØÊ∂àË¥πÂπ¥Êï∞ÔºåÊàñ "forever" Ë°®Á§∫Ê∞∏ËøúËä±‰∏çÂÆå
         */
        const calculateYearsUntilBroke = (initialPrincipal, annualExpense, annualRate) => {
            // ËΩ¨Êç¢Âà©Áéá‰∏∫Â∞èÊï∞
            const rateDecimal = annualRate / 100;

            // ÂΩìÂâçÊú¨Èáë
            let currentPrincipal = initialPrincipal;

            // Âπ¥‰ªΩËÆ°Êï∞Âô®
            let years = 0;

            // ÊåÅÁª≠ËÆ°ÁÆóÁõ¥Âà∞Èí±Ëä±ÂÆåÊàñË∂ÖËøáËÆæÂÆöÁöÑÊúÄÂ§ßÂπ¥Èôê
            while (years < MAX_YEARS) {
                // Ëé∑ÂèñÂΩìÂâçÂπ¥‰ªΩÁöÑÊî∂ÂÖ•
                const currentYearIncome = getIncomeByYear(years + 1);

                // ËÆ°ÁÆóÂπ¥ÂàùÂèØÁî®ÈáëÈ¢ù
                const availableAmount = currentPrincipal + currentYearIncome - annualExpense;

                // Âà§Êñ≠ÊòØÂê¶Ëøô‰∏ÄÂπ¥Â∞±Ëä±ÂÆå‰∫Ü
                if (availableAmount <= 0) {
                    return years + 1;
                }

                // ËÆ°ÁÆóÂπ¥Â∫ïÊú¨ÈáëÔºàÂä†‰∏äÂà©ÊÅØÔºâ
                currentPrincipal = availableAmount * (1 + rateDecimal);

                // Âπ¥‰ªΩÂä†‰∏Ä
                years++;
            }

            // Â¶ÇÊûúË∂ÖËøáËÆæÂÆöÁöÑÊúÄÂ§ßÂπ¥ÈôêËøòÊ≤°Ëä±ÂÆåÔºåËÆ§‰∏∫ÊòØÊ∞∏ËøúËä±‰∏çÂÆå
            return "forever";
        };

        /**
         * Ê†ºÂºèÂåñÁªìÊûúÊòæÁ§∫
         * @param {number|string} years - Âπ¥Êï∞Êàñ "forever"
         * @returns {string} Ê†ºÂºèÂåñÂêéÁöÑÊòæÁ§∫ÊñáÊú¨
         */
        const formatResult = (years) => {
            if (years === "forever") {
                return "Ê∞∏ËøúËä±‰∏çÂÆå";
            }
            return `Á¨¨${years}Âπ¥Ëä±ÂÆå`;
        };

        /**
         * Ê†πÊçÆÂπ¥Êï∞Ëé∑ÂèñÂØπÂ∫îÁöÑÊ†∑ÂºèÁ±ªÂêç
         * @param {number|string} years - Âπ¥Êï∞Êàñ "forever"
         * @returns {string} CSS Á±ªÂêç
         */
        const getResultClass = (years) => {
            if (years === "forever") {
                return "forever";
            }
            if (years <= 5) {
                return "years_1_5";
            }
            if (years <= 10) {
                return "years_6_10";
            }
            if (years <= 30) {
                return "years_11_30";
            }
            return "years_31_plus";
        };

        /**
         * ÁîüÊàêË°®Ê†º HTML
         * @param {number} annualRate - Âπ¥Âà©ÁéáÔºàÁôæÂàÜÊØîÔºâ
         */
        const generateTable = (annualRate) => {
            const table = document.getElementById("wealth_table");
            let html = "";

            // ÁîüÊàêË°®Â§¥
            html += "<thead><tr>";
            html += "<th>ÊØèÂπ¥Ëä±Ë¥π</th>";
            PRINCIPAL_AMOUNTS.forEach(amount => {
                html += `<th>${formatPrincipal(amount)}</th>`;
            });
            html += "</tr></thead>";

            // ÁîüÊàêË°®Ê†ºÂÜÖÂÆπ
            html += "<tbody>";
            ANNUAL_EXPENSES.forEach(expense => {
                html += "<tr>";
                html += `<td>ÊØèÂπ¥Ëä±${expense}‰∏á</td>`;

                PRINCIPAL_AMOUNTS.forEach(principal => {
                    const years = calculateYearsUntilBroke(principal, expense, annualRate);
                    const resultText = formatResult(years);
                    const resultClass = getResultClass(years);
                    html += `<td class="result_cell ${resultClass}">${resultText}</td>`;
                });

                html += "</tr>";
            });
            html += "</tbody>";

            table.innerHTML = html;
        };

        /**
         * Êõ¥Êñ∞È°µÈù¢ÊòæÁ§∫ÁöÑÂà©Áéá
         */
        const updateRateDisplay = () => {
            const rateInput = document.getElementById("annual_rate");
            const rateDisplay = document.getElementById("rate_display");
            rateDisplay.textContent = parseFloat(rateInput.value).toFixed(1);
        };

        /**
         * Êõ¥Êñ∞ÊúÄÂ§ßÂπ¥‰ªΩÈÖçÁΩÆ
         */
        const updateMaxYears = () => {
            const maxYearsInput = document.getElementById("max_years");
            const maxYearsDisplay = document.getElementById("max_years_display");
            const newMaxYears = parseInt(maxYearsInput.value) || DEFAULT_MAX_YEARS;
            
            MAX_YEARS = newMaxYears;
            maxYearsDisplay.textContent = MAX_YEARS;
            
            // Êõ¥Êñ∞Êî∂ÂÖ•ÊÆµÈÖçÁΩÆ
            const lastSegment = incomeSegments[incomeSegments.length - 1];
            if (lastSegment.endYear > MAX_YEARS) {
                lastSegment.endYear = MAX_YEARS;
                // Âà†Èô§Ë∂ÖÂá∫ËåÉÂõ¥ÁöÑÊÆµ
                incomeSegments = incomeSegments.filter(seg => seg.startYear <= MAX_YEARS);
            } else if (lastSegment.endYear < MAX_YEARS) {
                lastSegment.endYear = MAX_YEARS;
            }
            
            renderIncomeSegments();
        };

        /**
         * Ê∏≤ÊüìÊî∂ÂÖ•ÊÆµÈÖçÁΩÆÁïåÈù¢
         */
        const renderIncomeSegments = () => {
            const container = document.getElementById("income_segments");
            let html = "";

            incomeSegments.forEach((segment, index) => {
                const isLast = index === incomeSegments.length - 1;

                html += `<div class="income_segment">`;
                html += `<span class="segment_label">Âπ¥‰ªΩ</span>`;
                html += `<div class="segment_year_range">`;
                html += `<input type="number" class="segment_year_input" value="${segment.startYear}" readonly>`;
                html += `<span>Âà∞</span>`;

                // ÊúÄÂêé‰∏ÄÊÆµÁöÑÁªìÊùüÂπ¥‰ªΩÂßãÁªàÂèØ‰ª•ÁºñËæë
                if (isLast) {
                    html += `<input type="number" class="segment_year_input" 
                    value="${segment.endYear}" 
                    min="${segment.startYear}" 
                    max="${MAX_YEARS}"
                    data-index="${index}"
                    onchange="handleEndYearChange(${index}, this.value)">`;
                } else {
                    html += `<input type="number" class="segment_year_input" value="${segment.endYear}" readonly>`;
                }

                html += `<span>Âπ¥</span>`;
                html += `</div>`;

                html += `<span class="segment_label">ÊØèÂπ¥Êî∂ÂÖ•</span>`;
                html += `<input type="number" class="segment_income_input" 
                  value="${segment.income}" 
                  min="0"
                  step="1"
                  data-index="${index}"
                  onchange="handleIncomeChange(${index}, this.value)"
                  placeholder="ËæìÂÖ•ÈáëÈ¢ù">`;
                html += `<span class="segment_label">‰∏áÂÖÉ</span>`;

                // Âè™ÊúâÂú®ÊúÄÂêé‰∏ÄÊÆµ‰∏îÁªìÊùüÂπ¥‰ªΩÂ∞è‰∫é50Êó∂ÔºåÊâçÊòæÁ§∫ÊèêÁ§∫
                if (isLast && segment.endYear < MAX_YEARS) {
                    html += `<span class="segment_hint">Ôºà‰øÆÊîπÁªìÊùüÂπ¥‰ªΩÂèØÊ∑ªÂä†‰∏ã‰∏ÄÊÆµÔºâ</span>`;
                }

                html += `</div>`;
            });

            container.innerHTML = html;
        };

        /**
         * Â§ÑÁêÜÁªìÊùüÂπ¥‰ªΩÂèòÂåñ
         * @param {number} index - ÊÆµÁöÑÁ¥¢Âºï
         * @param {string} value - Êñ∞ÁöÑÂπ¥‰ªΩÂÄº
         */
        window.handleEndYearChange = (index, value) => {
            let endYear = parseInt(value);

            // È™åËØÅÂπ¥‰ªΩÊòØÂê¶‰∏∫ÊúâÊïàÊï∞Â≠ó
            if (isNaN(endYear)) {
                renderIncomeSegments();
                return;
            }

            // Â¶ÇÊûúÂ∞è‰∫éÂºÄÂßãÂπ¥‰ªΩÔºåËÆæÁΩÆ‰∏∫ÂºÄÂßãÂπ¥‰ªΩ
            if (endYear < incomeSegments[index].startYear) {
                endYear = incomeSegments[index].startYear;
            }

            // Â¶ÇÊûúË∂ÖËøá50ÔºåËá™Âä®ËÆæÁΩÆ‰∏∫50
            if (endYear > MAX_YEARS) {
                endYear = MAX_YEARS;
            }

            // Êõ¥Êñ∞ÂΩìÂâçÊÆµÁöÑÁªìÊùüÂπ¥‰ªΩ
            incomeSegments[index].endYear = endYear;

            // Â¶ÇÊûúÁªìÊùüÂπ¥‰ªΩÂ∞è‰∫é50ÔºåÈúÄË¶ÅÊ∑ªÂä†ÊàñÊõ¥Êñ∞‰∏ã‰∏ÄÊÆµ
            if (endYear < MAX_YEARS) {
                if (index === incomeSegments.length - 1) {
                    // Ê∑ªÂä†Êñ∞ÁöÑÊÆµ
                    incomeSegments.push({
                        startYear: endYear + 1,
                        endYear: MAX_YEARS,
                        income: 0
                    });
                } else {
                    // Êõ¥Êñ∞‰∏ã‰∏ÄÊÆµÁöÑÂºÄÂßãÂπ¥‰ªΩ
                    incomeSegments[index + 1].startYear = endYear + 1;
                }
            } else {
                // Â¶ÇÊûúÁªìÊùüÂπ¥‰ªΩÁ≠â‰∫é50ÔºåÂà†Èô§ÂêéÈù¢ÁöÑÊâÄÊúâÊÆµ
                incomeSegments = incomeSegments.slice(0, index + 1);
            }

            renderIncomeSegments();
            handleInputChange();
        };

        /**
         * Â§ÑÁêÜÊî∂ÂÖ•ÈáëÈ¢ùÂèòÂåñ
         * @param {number} index - ÊÆµÁöÑÁ¥¢Âºï
         * @param {string} value - Êñ∞ÁöÑÊî∂ÂÖ•ÂÄº
         */
        window.handleIncomeChange = (index, value) => {
            const income = parseFloat(value) || 0;
            incomeSegments[index].income = income;
            handleInputChange();
        };

        /**
         * Â§ÑÁêÜËæìÂÖ•ÂèòÂåñÂπ∂ÈáçÊñ∞ËÆ°ÁÆóË°®Ê†º
         */
        const handleInputChange = () => {
            const annualRate = parseFloat(document.getElementById("annual_rate").value) || DEFAULT_RATE;

            updateRateDisplay();
            generateTable(annualRate);
        };

        /**
         * Â§ÑÁêÜÊúÄÂ§ßÂπ¥‰ªΩÂèòÂåñ
         */
        const handleMaxYearsChange = () => {
            updateMaxYears();
            handleInputChange();
        };

        /**
         * ÂàùÂßãÂåñÈ°µÈù¢
         */
        const initPage = () => {
            // ÁªëÂÆöÂà©ÁéáËæìÂÖ•Ê°Ü‰∫ã‰ª∂
            document.getElementById("annual_rate").addEventListener("input", handleInputChange);

            // ÁªëÂÆöÊúÄÂ§ßÂπ¥‰ªΩËæìÂÖ•Ê°Ü‰∫ã‰ª∂
            document.getElementById("max_years").addEventListener("input", handleMaxYearsChange);

            // Ê∏≤ÊüìÊî∂ÂÖ•ÊÆµÈÖçÁΩÆ
            renderIncomeSegments();

            // ÂàùÂßãÂåñË°®Ê†º
            generateTable(DEFAULT_RATE);
        };

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÂàùÂßãÂåñ
        document.addEventListener("DOMContentLoaded", initPage);
    </script>
</body>

</html>